//>>built
define("gridx/core/model/FormatSorter",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/data/util/sorter","./_Extension"],function(_1,_2,_3,_4,_5){return _1("gridx.core.model.FormatSorter",_5,{priority:50,constructor:function(_6){this.cache=_6._cache;this.connect(this.cache,"onBeforeFetch","onBeforeFetch");this.connect(this.cache,"onAfterFetch","onAfterFetch");},onBeforeFetch:function(){this._oldCreateSortFunction=_4.createSortFunction;_4.createSortFunction=_3.hitch(this,this._createComparator);},onAfterFetch:function(){if(this._oldCreateSortFunction){_4.createSortFunction=this._oldCreateSortFunction;delete this._oldCreateSortFunction;}},_createSortFunc:function(_7,_8,_9,_a){return function(_b,_c){var a=_a.getValue(_b,_7),b=_a.getValue(_c,_7);return _8*_9(a,b);};},_createFormatSortFunc:function(_d,_e,_f,_10,_11,_12){var _13={};return function(_14,_15){var idA=_10.getIdentity(_14),idB=_10.getIdentity(_15);if(!_13[idA]){_13[idA]=_12(_11._itemToObject(_14));}if(!_13[idB]){_13[idB]=_12(_11._itemToObject(_15));}return _e*_f(_13[idA],_13[idB]);};},_createComparator:function(_16,_17){var _18=[],c=this.cache,map=_17.comparatorMap,bc=_4.basicComparator;_2.forEach(_16,function(_19){if(_19.colId!==undefined){var _1a=_19.attribute,dir=_19.descending?-1:1,_1b=bc,col=c.columns&&c.columns[_19.colId];if(map){if(typeof _1a!=="string"&&_1a.toString){_1a=_1a.toString();}_1b=map[_1a]||bc;}if(col&&col.comparator){_1b=col.comparator;}var _1c=col&&col.sortFormatted&&col.formatter;_18.push(_1c?this._createFormatSortFunc(_1a,dir,_1b,_17,c,_1c):this._createSortFunc(_1a,dir,_1b,_17));}},this);return function(_1d,_1e){var i,len,ret=0;for(i=0,len=_18.length;!ret&&i<len;++i){ret=_18[i](_1d,_1e);}return ret;};}});});