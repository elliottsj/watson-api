//>>built
define("gridx/modules/Header",["dojo/_base/declare","dojo/_base/array","dojo/_base/html","dojo/_base/lang","dojo/_base/Deferred","dojo/_base/query","dojo/_base/sniff","dojo/_base/event","dojo/keys","dojox/html/metrics","../core/_Module"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b){return _b.registerModule(_1("gridx.modules.Header",_b,{name:"header",required:["hLayout","vLayout"],getAPIPath:function(){return {header:this};},constructor:function(){this.domNode=_3.create("div",{"class":"dojoxGridxHeaderRow",role:"presentation"});this.innerNode=_3.create("div",{"class":"dojoxGridxHeaderRowInner",role:"row"});this.domNode.appendChild(this.innerNode);},destroy:function(){this.inherited(arguments);_3.destroy(this.domNode);},load:function(_c,_d){var g=this.grid,_e=this;g.vLayout.register(this,"domNode","headerNode");this.batchConnect([g,"onHScroll","_onHScroll"],[g,"onHeaderCellMouseOver","_onHeaderCellMouseHover"],[g,"onHeaderCellMouseOut","_onHeaderCellMouseHover"],[g,"_onResizeBegin",function(_f,ds){ds.header=new _5();this._adaptWidth();ds.header.callback();}],[g.hLayout,"onUpdateWidth","_adaptWidth"],[g,"setColumns","_adaptWidth"],g.autoWidth&&g.columnResizer&&[g.columnResizer,"onResize","_onColumnResize"]);this._initFocus();g._connectEvents(this.domNode,"_onMouseEvent",this);g.hLayout.loaded.then(function(){_e.loaded.callback();});},columnMixin:{headerNode:function(){return this.grid.header.getHeaderNode(this.id);}},defaultColumnWidth:60,getHeaderNode:function(id){return _6("[colid='"+id+"']",this.domNode)[0];},refresh:function(){var sb=["<table role=\"presentation\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tr>"],f=this.grid.focus,_10=this;_2.forEach(this.grid.columns(),function(col){sb.push("<th colid=\"",col.id,"\" class=\"dojoxGridxCell ",f&&f.currentArea()=="header"&&col.id==_10._focusHeaderId?_10._focusClass:"","\" role=\"columnheader\" aria-readonly=\"true\" tabindex=\"-1\" style=\"width: ",(col.getWidth()||_10.arg("defaultColumnWidth")+"px"),"\"><div class=\"dojoxGridxSortNode\">",col.name(),"</div></th>");});sb.push("</tr></table>");this.innerNode.innerHTML=sb.join("");},onMoveToHeaderCell:function(){},_onColumnResize:function(_11,_12,_13){this._columnsWidth+=_12-_13;var g=this.grid;g.bodyNode.style.width=this._columnsWidth+"px";g.domNode.style.width=g.hLayout.lead+g.hLayout.tail+this._columnsWidth+"px";},_adaptWidth:function(){var g=this.grid;var ltr=g.isLeftToRight();var _14=ltr?"marginLeft":"marginRight";var _15=ltr?"marginRight":"marginLeft";var _16=g.hLayout.lead;var _17=g.hLayout.tail;_3.style(this.innerNode,_14,_16+"px");_3.style(this.innerNode,_15,_17+"px");_3.style(g.bodyNode,_14,_16+"px");if(g.autoWidth){this.refresh();if(!this.domNode.parentNode){g.headerNode.appendChild(this.domNode);}var _18=_6("th.dojoxGridxCell",this.innerNode);var _19=0;_18.forEach(function(_1a){var w=_7("webkit")?_1a.offsetWidth:_3.style(_1a,"width");_19+=_1a.offsetWidth;g._columnsById[_1a.getAttribute("colid")].width=w+"px";});this._columnsWidth=_19;g.bodyNode.style.width=_19+"px";g.domNode.style.width=(_16+_17+_19)+"px";}else{var _1b=g.domNode.clientWidth-_16-_17;g.bodyNode.style.width=_1b+"px";var _1c=[];_2.forEach(g._columns,function(col){if(!col.width||col.width=="auto"){col.width="auto";_1c.push(col);}else{if(/%$/.test(col.width)){col.width=(_1b*parseFloat(col.width,10)/100)+"px";}}});this.refresh();if(!this.domNode.parentNode){g.headerNode.appendChild(this.domNode);}var _1d=0;_2.forEach(g._columns,function(col){if(col.width!="auto"){var _1e=this.getHeaderNode(col.id);var w=_7("webkit")?_1e.offsetWidth:_3.style(_1e,"width");col.width=w+"px";_1d+=w;}},this);var _1f=(g._spacingWidth?g._spacingWidth:0);var w=(_1b>_1d?((_1b-_1d-_1f)/_1c.length):this.arg("defaultColumnWidth"))+"px";_2.forEach(_1c,function(col){col.width=w;});this.refresh();}},_onHScroll:function(_20){this.innerNode.scrollLeft=_20;},_onMouseEvent:function(_21,e){var g=this.grid,_22="onHeaderCell"+_21,_23="onHeader"+_21;if(g._isConnected(_22)||g._isConnected(_23)){this._decorateEvent(e);if(e.columnIndex>=0){this.grid[_22](e);}this.grid[_23](e);}},_decorateEvent:function(e){var _24=e.target;while(_24&&_24!==this.domNode){if(_24.tagName.toLowerCase()==="th"){var col=this.grid._columnsById[_24.getAttribute("colid")];if(col){e.columnId=col.id;e.columnIndex=col.index;}return;}_24=_24.parentNode;}},_onHeaderCellMouseHover:function(e){var _25=this.getHeaderNode(e.columnId);_3[e.type=="mouseout"?"removeClass":"addClass"](_25,"dojoxGridxHeaderCellOver");},_focusHeaderId:null,_focusClass:"dojoxGridxHeaderCellFocus",_initFocus:function(){var g=this.grid;if(g.focus){g.focus.registerArea({name:"header",priority:0,focusNode:this.domNode,doFocus:_4.hitch(this,"_doFocus"),doBlur:_4.hitch(this,"_blurNode"),onBlur:_4.hitch(this,"_blurNode"),connects:[this.connect(this.domNode,"onkeydown","_onKeyDown"),this.connect(g,"onHeaderCellMouseDown",function(evt){this._focusNode(this.getHeaderNode(evt.columnId));})]});}},_doFocus:function(evt,_26){var _27;if(this._focusHeaderId){_27=this.getHeaderNode(this._focusHeaderId);}return this._focusNode(_27||_6("th.dojoxGridxCell",this.domNode)[0]);},_focusNode:function(_28){if(_28){this._focusHeaderId=_28.getAttribute("colid");if(this._focusHeaderId){this._blurNode();_28.focus();if(this.grid.hScroller){var _29=_28.parentNode.parentNode.parentNode.parentNode;this.grid.hScroller.scroll(_29.scrollLeft);}_3.addClass(_28,this._focusClass);return true;}}return false;},_blurNode:function(){var _2a=_6("th."+this._focusClass,this.domNode)[0];if(_2a){_3.removeClass(_2a,this._focusClass);}return true;},_onKeyDown:function(evt){if(this._focusHeaderId){var col,_2b=this.grid,dir=_2b.isLeftToRight()?1:-1,_2c=evt.keyCode==_9.LEFT_ARROW?-dir:dir;if(evt.keyCode==_9.LEFT_ARROW||evt.keyCode==_9.RIGHT_ARROW){_8.stop(evt);col=_2b._columnsById[this._focusHeaderId];col=_2b._columns[col.index+_2c];if(col){this._focusNode(this.getHeaderNode(col.id));this.onMoveToHeaderCell(col.id,evt);}}}}}));});