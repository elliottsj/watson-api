//>>built
define("gridx/modules/IndirectSelect",["dojo/_base/declare","dojo/_base/array","dojo/_base/query","dojo/_base/lang","dojo/_base/html","dojo/_base/Deferred","../core/_Module","../util","./RowHeader"],function(_1,_2,_3,_4,_5,_6,_7,_8){return _7.registerModule(_1("gridx.modules.IndirectSelect",_7,{name:"indirectSelect",required:["rowHeader","selectRow"],load:function(){var g=this.grid,_9=g.focus,_a=this;g.rowHeader.cellProvider=_4.hitch(this,this._createSelector);this.batchConnect([g.select.row,"onHighlightChange","_onHighlightChange"],[g.select.row,"onSelectionChange","_onSelectionChange"],[g,"onRowMouseOver","_onMouseOver"],[g,"onRowMouseOut","_onMouseOut"],_9&&[_9,"onFocusArea",function(_b){if(_b=="rowHeader"){this._onMouseOver();}}],_9&&[_9,"onBlurArea",function(_c){if(_c=="rowHeader"){this._onMouseOut();}}]);if(g.select.row.selectAll){g.rowHeader.headerProvider=_4.hitch(this,this._createSelectAllBox);if(_9){this._initFocus();}g.rowHeader.loaded.then(function(){_a.connect(g,"onRowHeaderHeaderMouseDown","_onSelectAll");});}this.loaded.callback();},_createSelector:function(id){var _d=_3("[rowid=\""+id+"\"]",this.grid.bodyNode)[0],_e=_d&&_5.hasClass(_d,"dojoxGridxRowSelected");return this._createCheckBox(_e);},_createCheckBox:function(_f){var _10=this._getDijitClass();return ["<span class=\"dojoxGridxIndirectSelectionCheckBox dijitReset dijitInline ",_10," ",_f?_10+"Checked":"","\"><span class=\"dojoxGridxIndirectSelectionCheckBoxInner\">â–¡</span></span>"].join("");},_createSelectAllBox:function(){return this._createCheckBox(this._allSelected);},_onHighlightChange:function(_11,_12){var _13=_3("[visualindex=\""+_11.row+"\"].dojoxGridxRowHeaderRow .dojoxGridxIndirectSelectionCheckBox",this.grid.rowHeader.bodyNode)[0];if(_13){_5[_12?"addClass":"removeClass"](_13,this._getDijitClass()+"Checked");}},_onMouseOver:function(){if(!this.grid.select.row.holdingCtrl){this._holdingCtrl=false;this.grid.select.row.holdingCtrl=true;}},_onMouseOut:function(){if(this.hasOwnProperty("_holdingCtrl")){this.grid.select.row.holdingCtrl=false;delete this._holdingCtrl;}},_getDijitClass:function(){return this._isSingle()?"dijitRadio":"dijitCheckBox";},_isSingle:function(){var _14=this.grid.select.row;return _14.hasOwnProperty("multiple")&&!_14.multiple;},_onSelectAll:function(){var g=this.grid,_15=g.body;g.select.row[this._allSelected?"deselectByIndex":"selectByIndex"]([_15.rootStart,_15.rootStart+_15.rootCount-1]);},_onSelectionChange:function(_16){var _17=this.grid.body,_18,d,_19=this.model,_1a=this,_1b=_17.rootStart,_1c=_17.rootCount;if(_1c===_19.size()){_18=_1c==_16.length;}else{d=new _6();_19.when({start:_1b,count:_1c},function(){var _1d=_2.filter(_2.map(_16,function(id){return _19.idToIndex(id);}),function(_1e){return _1e>=_1b&&_1e<_1b+_1c;});_18=_1c==_1d.length;d.callback();});}if(this.grid.select.row.selectAll){_6.when(d,function(){_1a._allSelected=_18;var _1f=_1a.grid.rowHeader.headerCellNode.firstChild;_5[_18?"addClass":"removeClass"](_1f,_1a._getDijitClass()+"Checked");});}},_initFocus:function(){var _20=this.grid.rowHeader;var _21=function(evt){_8.stopEvent(evt);_5.addClass(_20.headerCellNode,"dojoxGridxHeaderCellFocus");_20.headerCellNode.focus();return true;};var _22=function(){_5.removeClass(_20.headerCellNode,"dojoxGridxHeaderCellFocus");return true;};this.grid.focus.registerArea({name:"selectAll",priority:0.89,focusNode:_20.headerNode,doFocus:_21,doBlur:_22,onFocus:_21,onBlur:_22});}}));});