//>>built
define("gridx/modules/Printer",["../core/_Module","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/_base/html","dojo/_base/xhr","dojo/_base/array","dojo/_base/sniff","dojo/query","dojo/DeferredList"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){return _1.registerModule(_2("gridx.modules.Printer",_1,{name:"printer",forced:["table"],constructor:function(_b,_c){_c=_3.isObject(_c)?_c:{};this._title=_c.title?_c.title:"";if(_c.cssFiles){if(_3.isString(_c.cssFiles)){this._cssFiles=[_c.cssFiles];}else{if(_3.isArray(_c.cssFiles)){this._cssFiles=_c.cssFiles;}else{this._cssFiles=null;}}}},getAPIPath:function(){return {"printer":this};},load:function(_d,_e){this.loaded.callback();},print:function(_f){var _10=this;this.grid.exporter.toTable(_f).then(function(str){_10._wrapHTML(_10._title,_10._cssFiles,str).then(function(_11){_10._print(_11);});});},_loadCSSFiles:function(_12){var dl=_7.map(_12,function(_13){_13=_3.trim(_13);if(_13.substring(_13.length-4).toLowerCase()===".css"){return _6.get({url:_13});}else{var d=new _4();d.callback(_13);return d;}});return _a.prototype.gatherResults(dl);},_wrapHTML:function(_14,_15,_16){return this._loadCSSFiles(_15).then(function(_17){var i,sb=["<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">","<html ",_5._isBodyLtr()?"":"dir=\"rtl\"","><head><title>",_14,"</title><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"></meta>"];for(i=0;i<_17.length;++i){sb.push("<style type=\"text/css\">",_17[i],"</style>");}sb.push("</head>");if(_16.search(/^\s*<body/i)<0){_16="<body>"+_16+"</body>";}sb.push(_16,"</html>");return sb.join("");});},_print:function(_18){var win,_19=this,_1a=function(w){var doc=w.document;doc.open();doc.write(_18);doc.close();};if(!window.print){return;}else{if(_8("chrome")||_8("opera")){win=window.open("javascript: ''","","status=0,menubar=0,location=0,toolbar=0,width=1,height=1,resizable=0,scrollbars=0");_1a(win);win.print();win.close();}else{var fn=this._printFrame,dn=this.grid.domNode;if(!fn){var _1b=dn.id+"_print_frame";if(!(fn=_5.byId(_1b))){fn=_5.create("iframe");fn.id=_1b;fn.frameBorder=0;_5.style(fn,{width:"1px",height:"1px",position:"absolute",right:0,bottom:0,border:"none",overflow:"hidden"});if(!_8("ie")){_5.style(fn,"visibility","hidden");}dn.appendChild(fn);}this._printFrame=fn;}win=fn.contentWindow;_1a(win);win.focus();win.print();}}}}));});