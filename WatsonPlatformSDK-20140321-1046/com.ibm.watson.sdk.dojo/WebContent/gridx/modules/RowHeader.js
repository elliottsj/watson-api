//>>built
define("gridx/modules/RowHeader",["dojo/_base/declare","dojo/_base/query","dojo/_base/array","dojo/_base/lang","dojo/_base/html","dojo/keys","../core/_Module","../util"],function(_1,_2,_3,_4,_5,_6,_7,_8){return _7.registerModule(_1("gridx.modules.RowHeader",_7,{name:"rowHeader",required:["hLayout"],constructor:function(){this.headerNode=_5.create("div",{"class":"dojoxGridxRowHeaderHeader",innerHTML:["<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"width: ",this.width,";\"><tr><th class=\"dojoxGridxRowHeaderHeaderCell\" tabindex=\"-1\"></th></tr></table>"].join("")});this.bodyNode=_5.create("div",{"class":"dojoxGridxRowHeaderBody"});},getAPIPath:function(){return {rowHeader:this};},load:function(){this._modifyHeaderBody();this._initFocus();this.loaded.callback();},width:"20px",onMoveToRowHeaderCell:function(){},headerProvider:function(){return "";},cellProvider:function(){return "";},update:function(){this.headerCellNode.innerHTML=this.headerProvider();this._updateBody();},_updateBody:function(){var sb=[];_3.forEach(this.grid.bodyNode.childNodes,function(_9){sb.push(this._buildRow(_9));},this);this.bodyNode.innerHTML=sb.join("");this.bodyNode.scrollTop=this.grid.bodyNode.scrollTop;if(this.grid.focus&&this.grid.focus.currentArea()=="rowHeader"){this._focusRow(this.grid.body._focusCellRow);}},_modifyHeaderBody:function(){var g=this.grid,w=this.arg("width");g._initEvents(["RowHeaderHeader","RowHeaderCell"],this.grid._eventNames);g.header.domNode.appendChild(this.headerNode);this.headerNode.style.width=w;this.headerCellNode=_2("th",this.headerNode)[0];g._connectEvents(this.headerNode,"_onHeaderMouseEvent",this);g.mainNode.appendChild(this.bodyNode);this.bodyNode.style.width=w;g.hLayout.register(null,this.bodyNode);this.batchConnect([g.body,"onRender","update"],[g.bodyNode,"onscroll","_updateBody"],[g,"onRowMouseOver","_onRowMouseOver"],[g,"onRowMouseOut","_onRowMouseOut"]);g._connectEvents(this.bodyNode,"_onBodyMouseEvent",this);},_buildRow:function(_a){var _b=[_a.getAttribute("rowid"),_a.getAttribute("visualindex"),_a.getAttribute("rowindex"),_a.getAttribute("parentid")];return ["<div class=\"dojoxGridxRowHeaderRow\" rowid=\"",_b[0],"\" parentid=\"",_b[3],"\" rowindex=\"",_b[2],"\" visualindex=\"",_b[1],"\"><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"height: ",_5.style(_a,"height"),"px;\"><tr><td class=\"dojoxGridxRowHeaderCell\" tabindex=\"-1\">",this.cellProvider.apply(this,_b),"</td></tr></table></div>"].join("");},_onHeaderMouseEvent:function(_c,e){var g=this.grid,_d="onRowHeaderHeader"+_c,_e="onHeader"+_c;if(g._isConnected(_d)){g[_d](e);}if(g._isConnected(_e)){g[_e](e);}},_onBodyMouseEvent:function(_f,e){var g=this.grid,_10="onRowHeaderCell"+_f,_11="onRow"+_f,_12=g._isConnected(_10),_13=g._isConnected(_11);if(_12||_13){this._decorateBodyEvent(e);if(e.rowIndex>=0){if(e.isRowHeader&&_12){g[_10](e);}if(_13){g[_11](e);}}}},_decorateBodyEvent:function(e){var _14=e.target||e.originalTarget;while(_14&&_14!==this.bodyNode){if(_5.hasClass(_14,"dojoxGridxRowHeaderCell")){e.isRowHeader=true;}else{if(_14.tagName.toLowerCase()==="div"&&_5.hasClass(_14,"dojoxGridxRowHeaderRow")){e.rowId=_14.getAttribute("rowid");e.parentId=_14.getAttribute("parentid");e.rowIndex=parseInt(_14.getAttribute("rowindex"),10);e.visualIndex=parseInt(_14.getAttribute("visualindex"),10);return;}}_14=_14.parentNode;}},_onRowMouseOver:function(e){var _15=_2("[rowid=\""+e.rowId+"\"].dojoxGridxRowHeaderRow",this.bodyNode)[0];if(_15){_5.addClass(_15,"dojoxGridxRowOver");}},_onRowMouseOut:function(e){var _16=_2("[rowid=\""+e.rowId+"\"].dojoxGridxRowHeaderRow",this.bodyNode)[0];if(_16){_5.removeClass(_16,"dojoxGridxRowOver");}},_initFocus:function(){var _17=this.grid.focus;if(_17){_17.registerArea({name:"rowHeader",priority:0.9,focusNode:this.bodyNode,doFocus:_4.hitch(this,this._doFocus),onFocus:_4.hitch(this,this._onFocus),doBlur:_4.hitch(this,this._blur),onBlur:_4.hitch(this,this._blur),connects:[this.connect(this.bodyNode,"onkeydown","_onKeyDown")]});}},_doFocus:function(evt){if(this._focusRow(this.grid.body._focusCellRow)){_8.stopEvent(evt);return true;}},_onFocus:function(evt){var _18=evt.target;while(_18!=this.bodyNode){if(_5.hasClass(_18,"dojoxGridxRowHeaderRow")){var r=this.grid.body._focusCellRow=parseInt(_18.getAttribute("visualindex"),10);this._focusRow(r);return true;}_18=_18.parentNode;}},_focusRow:function(_19){this._blur();var _1a=_2("[visualindex=\""+_19+"\"] .dojoxGridxRowHeaderCell",this.bodyNode)[0];_1a=_1a||this.bodyNode.firstChild;if(_1a){_5.addClass(_1a,"dojoxGridxCellFocus");_1a.focus();}return _1a;},_blur:function(){_2(".dojoxGridxCellFocus",this.bodyNode).forEach(function(_1b){_5.removeClass(_1b,"dojoxGridxCellFocus");});return true;},_onKeyDown:function(evt){if(this.grid.focus.currentArea()=="rowHeader"&&evt.keyCode==_6.UP_ARROW||evt.keyCode==_6.DOWN_ARROW){_8.stopEvent(evt);var _1c=evt.keyCode==_6.UP_ARROW?-1:1,_1d=this.grid.body,_1e=this,r=_1d._focusCellRow+_1c;_1d._focusCellRow=r=r<0?0:(r>=_1d.visualCount?_1d.visualCount-1:r);this.grid.vScroller.scrollToRow(r).then(function(){_1e._focusRow(r);_1e.onMoveToRowHeaderCell(r,evt);});}}}));});