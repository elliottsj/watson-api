//>>built
define("gridx/modules/SingleSort",["dojo/_base/declare","dojo/_base/lang","dojo/keys","../core/_Module"],function(_1,_2,_3,_4){return _4.registerModule(_1("gridx.modules.SingleSort",_4,{name:"sort",forced:["header"],required:["vLayout"],getAPIPath:function(){return {sort:this};},preload:function(_5){var g=this.grid,_6;this.connect(g,"onHeaderCellClick","_onClick");this.connect(g,"onHeaderCellKeyDown","_onKeyDown");if(g.persist){var _7=this;_6=g.persist.registerAndLoad("sort",function(){return [{colId:_7._sortId,descending:_7._sortDescend}];});}_6=_6||_5.preSort||g.preSort;if(_2.isArrayLike(_6)){_6=_6[0];}if(_6&&_6.colId){this._sortId=_6.colId;this._sortDescend=_6.descending;this.model.sort([_6]);}},load:function(){for(var _8 in this.grid._columnsById){this._initHeader(_8);}if(this._sortId){this._updateHeader(this._sortId,this._sortDescend);}this.loaded.callback();},columnMixin:{sort:function(_9,_a){this.grid.sort.sort(this.id,_9,_a);return this;},isSorted:function(){return this.grid.sort.isSorted(this.id);},clearSort:function(_b){if(this.isSorted()){this.grid.sort.clear(_b);}return this;},isSortable:function(){var _c=this.grid._columnsById[this.id];return _c.sortable||_c.sortable===undefined;},setSortable:function(_d){this.grid._columnsById[this.id].sortable=!!_d;return this;}},sort:function(_e,_f,_10){var g=this.grid,col=g._columnsById[_e];if(col&&(col.sortable||col.sortable===undefined)){if(this._sortId!==_e||this._sortDescend===!_f){this._updateHeader(_e,_f);}this.model.sort([{colId:_e,descending:_f}]);if(!_10){g.body.refresh();}}},isSorted:function(_11){if(_11===this._sortId){return this._sortDescend?-1:1;}return 0;},clear:function(_12){if(this._sortId!==null){this._initHeader(this._sortId);this.model.sort();if(!_12){this.grid.body.refresh();}}},getSortData:function(){return this._sortId?[{colId:this._sortId,descending:this._sortDescend}]:[];},_sortId:null,_sortDescend:null,_initHeader:function(_13){var _14=this.grid.header.getHeaderNode(_13);_14.innerHTML=["<div class='dojoxGridxSortNode'>",this.grid.column(_13,true).name(),"</div>"].join("");_14.removeAttribute("aria-sort");},_updateHeader:function(_15,_16){if(this._sortId&&this._sortId!==_15){this._initHeader(this._sortId);}this._sortId=_15;this._sortDescend=!!_16;var str=["<div class='dojoxGridxSortNode ",(_16?"dojoxGridxSortDown":"dojoxGridxSortUp"),"'><div class='dojoxGridxArrowButtonChar'>",(_16?"&#9662;":"&#9652;"),"</div><div role='presentation' class='dojoxGridxArrowButtonNode'></div><div class='dojoxGridxColCaption'>",this.grid.column(_15,true).name(),"</div></div>"].join("");var _17=this.grid.header.getHeaderNode(_15);_17.innerHTML=str;_17.setAttribute("aria-sort",_16?"descending":"ascending");this.grid.vLayout.reLayout();},_onClick:function(e){this.sort(e.columnId,(this._sortId!==e.columnId?false:!this._sortDescend));},_onKeyDown:function(e){if(e.keyCode==_3.ENTER){this._onClick(e);}}}));});