//>>built
define("gridx/modules/VScroller",["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/html","dojo/_base/event","dojo/_base/sniff","dojo/query","dojox/html/metrics","../core/_Module"],function(_1,_2,_3,_4,_5,_6,_7,_8){return _8.registerModule(_1("gridx.modules.VScroller",_8,{name:"vscroller",required:["hLayout"],forced:["body","vLayout"],getAPIPath:function(){return {vScroller:this};},preload:function(){this.domNode=this.grid.vScrollerNode;this.stubNode=this.domNode.firstChild;if(this.grid.autoHeight){this.domNode.style.display="none";}this.grid.hLayout.register(null,this.domNode,true);},load:function(_9,_a){var _b=this,g=this.grid;this.batchConnect([this.domNode,"onscroll","_doScroll"],[g.bodyNode,"onmousewheel","_onMouseWheel"],[g.body,"onRender","_onBodyChange"],[g.body,"onVisualCountChange","_onRowCountChange"],[g.body,"onRootRangeChange","_onRootRangeChange"],_5("ff")&&[g.bodyNode,"DOMMouseScroll","_onMouseWheel"]);_a.then(function(){_2.when(_b._init(_9),function(){_b.loaded.callback();});});},scrollToPercentage:function(_c){this.domNode.scrollTop=this.stubNode.style.clientHeight*_c/100;},scrollToRow:function(_d,_e){var d=new _2(),bn=this.grid.bodyNode,_f=0,_10=_6("[visualindex=\""+_d+"\"]",this.grid.bodyNode)[0];if(_10){if(_e){this.domNode.scrollTop=_10.offsetTop;d.callback(true);return d;}else{if(_10.offsetTop<bn.scrollTop){_f=_10.offsetTop-bn.scrollTop;}else{if(_10.offsetTop+_10.offsetHeight>bn.scrollTop+bn.clientHeight){_f=_10.offsetTop+_10.offsetHeight-bn.scrollTop-bn.clientHeight;}else{d.callback(true);return d;}}}this.domNode.scrollTop+=_f;}d.callback(!!_10);return d;},_init:function(){return this._onRootRangeChange(this.grid.body.rootStart,this.grid.body.rootCount);},_doScroll:function(){this.grid.bodyNode.scrollTop=this.domNode.scrollTop;},_onMouseWheel:function(e){if(!this.grid.autoHeight){var _11=typeof e.wheelDelta==="number"?e.wheelDelta/3:(-40*e.detail);this.domNode.scrollTop-=_11;_4.stop(e);}},_onBodyChange:function(){_3.style(this.stubNode,"height",this.grid.bodyNode.scrollHeight+"px");this._doScroll();},_onRowCountChange:function(){},_onRootRangeChange:function(_12,_13){return this.model.when({start:_12,count:_13},function(){_13=_13||this.model.size()-_12;this.grid.body.renderRows(_12,_13);},this);}}));});