//>>built
define("gridx/modules/dnd/Row",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/_base/html","dojo/_base/sniff","dojo/query","./_Base","../../core/_Module"],function(_1,_2,_3,_4,_5,_6,_7,_8){return _8.registerModule(_1("gridx.modules.dnd.Row",_7,{name:"dndRow",required:["selectRow","moveRow"],type:"Row",accept:["grid/cells"],copyWhenDragOut:false,_extraCheckReady:function(_9){return this._selector.isSelected(_9.rowId);},_buildDndNodes:function(){var sb=[],_a=this._selectedRowIds=this.model.getMarkedIds();_2.forEach(_a,function(_b){sb.push("<div id='",this.grid.id,"_dnditem_row_",_b,"' rowid='",_b,"'></div>");});return sb.join("");},_getDndCount:function(){return this._selectedRowIds.length;},_beginAutoScroll:function(){this._autoScrollH=this.grid.autoScroll.horizontal;this.grid.autoScroll.horizontal=false;},_endAutoScroll:function(){this.grid.autoScroll.horizontal=this._autoScrollH;},_calcTargetAnchorPos:function(_c,_d){var _e=_c.target,_f=this.grid.body,_10=this,ret={width:_d.w+"px"};var _11=function(n){var _12=parseInt(n.getAttribute("rowindex"),10);if(_10._selector.isSelected(n.getAttribute("rowid"))){var _13=_f.getRowNode({rowIndex:_12-1});while(_13&&_10._selector.isSelected(_13.getAttribute("rowid"))){_13=_f.getRowNode({rowIndex:--_12-1});}n=_f.getRowNode({rowIndex:_12});}_10._target=n?_12:undefined;if(n){ret.top=(_4.position(n).y-_d.y)+"px";}return ret;};if(!_5("ff")){while(_e){if(_4.hasClass(_e,"dojoxGridxRow")){return _11(_e);}_e=_e.parentNode;}}var _14=this.grid.bodyNode.firstChild;var idx=parseInt(_14.getAttribute("visualindex"),10);var pos=_4.position(_14);if(idx===0&&_c.clientY<=pos.y+pos.h){ret.top=(pos.y-_d.y)+"px";this._target=0;}else{var _15=this.grid.bodyNode.lastChild;idx=parseInt(_15.getAttribute("visualindex"),10);pos=_4.position(_15);if(idx===_f.visualCount-1&&_c.clientY>pos.y+pos.h){ret.top=(pos.y+pos.h-_d.y)+"px";this._target=_f.visualCount;}else{if(_6(".dojoxGridxRow",this.grid.bodyNode).some(function(_16){var _17=_4.position(_16);if(_17.y<=_c.clientY&&_17.y+_17.h>=_c.clientY){_e=_16;return true;}})){return _11(_e);}else{return null;}}}return ret;},_onDropInternal:function(_18,_19){if(this._target>=0){this.model.when({id:this._selectedRowIds},function(){var _1a=_2.map(this._selectedRowIds,function(_1b){return this.model.idToIndex(_1b);},this);this.grid.move.row.move(_1a,this._target);},this);}},_onDropExternalGrid:function(_1c,_1d,_1e){var _1f=_1c.dndRow._selectedRowIds;var _20=_1c.dndRow.grid;var _21=this.grid;var _22=_20.store;var _23=_21.store;var _24=this._target;var _25;_20.model.when({id:_1f},function(){_25=_21.model.size();_2.forEach(_1f,function(_26){var _27=_20.model.byId(_26);var _28=_3.clone(_27.rawData);try{if(this._setIdentity){this._setIdentity(_28);}if(_23.newItem){var _29=_23.newItem(_28);_23.getIdentity(_29);}else{if(_23.add){_23.add(_28);}}if(!_1e&&!_1c.dndRow.arg("copyWhenDragOut")){if(_22.deleteItem){_22.deleteItem(_27.item);}else{if(_22.remove){_22.remove(_26);}}}}catch(e){console.error("Fatal Error: gridx.modules.dnd.Row: ",e);}});_21.move.row.moveRange(_25,_1f.length,_24);});},_onDropExternalOther:function(_2a,_2b,_2c){}}));});