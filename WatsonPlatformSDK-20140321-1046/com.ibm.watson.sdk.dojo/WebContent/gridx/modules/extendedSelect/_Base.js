//>>built
define("gridx/modules/extendedSelect/_Base",["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/html","dojo/_base/Deferred","dojo/_base/window","dojo/keys","../../core/_Module","../AutoScroll"],function(_1,_2,_3,_4,_5,_6,_7,_8){return _1(_8,{required:["autoScroll"],getAPIPath:function(){var _9={select:{}};_9.select[this._type]=this;return _9;},load:function(){this._refSelectedIds=[];this.subscribe("gridClearSelection_"+this.grid.id,function(_a){if(_a!=this._type){this.clear();}});this.batchConnect([this.grid.body,"onRender","_onRender"],[_6.doc,"onmouseup","_end"],[_6.doc,"onkeydown",function(e){if(e.keyCode===_7.SHIFT){_4.setSelectable(this.grid.domNode,false);}}],[_6.doc,"onkeyup",function(e){if(e.keyCode===_7.SHIFT){_4.setSelectable(this.grid.domNode,true);}}]);this._init();this.loaded.callback();},enabled:true,holdingCtrl:false,holdingShift:false,selectById:function(){return this._subMark("_markById",arguments,true);},deselectById:function(){return this._subMark("_markById",arguments,false);},selectByIndex:function(){return this._subMark("_markByIndex",arguments,true);},deselectByIndex:function(){return this._subMark("_markByIndex",arguments,false);},selectAll:function(){return this._subMark("_markAll",arguments,true);},clear:function(){return this._subMark("_markAll",arguments,false);},onSelectionChange:function(_b,_c){},_subMark:function(_d,_e,_f){if(this.arg("enabled")){if(_f){_2.publish("gridClearSelection_"+this.grid.id,[this._type]);}this._lastSelectedIds=this.getSelected();this._refSelectedIds=[];return _5.when(this[_d](_e,_f),_3.hitch(this,this._onSelectionChange));}},_start:function(_10,_11,_12){if(!this._selecting&&!this._marking&&this.arg("enabled")){_4.setSelectable(this.grid.domNode,false);var _13=this._isSelected(_10);_12=_12||this.arg("holdingShift");if(_12&&this._lastStartItem){this._isRange=true;this._toSelect=this._lastToSelect;this._startItem=this._lastStartItem;this._currentItem=this._lastEndItem;}else{this._startItem=_10;this._currentItem=null;if(_11||this.arg("holdingCtrl")){this._toSelect=!_13;}else{this._toSelect=true;this.clear();}}_2.publish("gridClearSelection_"+this.grid.id,[this._type]);this._beginAutoScroll();this.grid.autoScroll.enabled=true;this._lastSelectedIds=this.getSelected();this._selecting=true;this._highlight(_10);}},_highlight:function(_14){if(this._selecting){var _15=this._startItem,_16=this._currentItem,_17=this,_18=function(_19,to,_1a){_19=_19[_17._type];to=to[_17._type];var dir=_19<to?1:-1;for(;_19!=to;_19+=dir){var _1b={};_1b[_17._type]=_19;_17._highlightSingle(_1b,_1a);}};if(_16===null){this._highlightSingle(_14,true);}else{if(this._inRange(_14[this._type],_15[this._type],_16[this._type])){_18(_16,_14,false);}else{if(this._inRange(_15[this._type],_14[this._type],_16[this._type])){_18(_16,_15,false);_16=_15;}_18(_14,_16,true);}}this._currentItem=_14;this._focus(_14);}},_end:function(){if(this._selecting){this._endAutoScroll();this.grid.autoScroll.enabled=false;this._selecting=false;this._marking=true;var d=this._addToSelected(this._startItem,this._currentItem,this._toSelect);this._lastToSelect=this._toSelect;this._lastStartItem=this._startItem;this._lastEndItem=this._currentItem;this._startItem=this._currentItem=this._isRange=null;_5.when(d,_3.hitch(this,function(){_4.setSelectable(this.grid.domNode,true);this._marking=false;this._onSelectionChange();}));}},_highlightSingle:function(_1c,_1d){_1d=_1d?this._toSelect:this._isSelected(_1c);this._doHighlight(_1c,_1d);},_onSelectionChange:function(){var _1e=this.getSelected();this.onSelectionChange(_1e,this._lastSelectedIds);this._lastSelectedIds=_1e;},_inRange:function(_1f,_20,end,_21){return ((_1f>=_20&&_1f<=end)||(_1f>=end&&_1f<=_20))&&(_21||_1f!=end);}});});