//>>built
require({cache:{"url:gridx/templates/FilterBar.html":"<input type=\"button\" dojoType=\"dijit.form.Button\" \n\ticonClass=\"dojoxGridxFilterBarBtnIcon\" label=\"...\" title=\"Define filter.\"/>\n<div class=\"dojoxGridxFilterBarStatus\"><span>No filter applied.</span><span class=\"dojoxGridxFilterBarCloseBtn\" title=\"Hide\"></span></div>\n"}});define("gridx/modules/filter/FilterBar",["dojo/_base/kernel","dijit","../../core/_Module","dojo/text!../../templates/FilterBar.html","dijit/TooltipDialog","dijit/popup","dijit/Tooltip","dojo/date/locale","./Filter","./FilterDialog","./FilterConfirmDialog","./FilterTooltip","dojo/i18n!../../nls/FilterBar","dojo/_base/declare","dojo/_base/array","dojo/_base/html","dojo/query","dojo/parser","dojo/string"],function(_1,_2,_3,_4){return _3.registerModule(_1.declare("gridx.modules.filter.FilterBar",_3,{name:"filterBar",forced:["filter"],getAPIPath:function(){return {filterBar:this};},closeFilterBarButton:true,defineFilterButton:true,tooltipDelay:300,maxRuleCount:0,ruleCountToConfirmClearFilter:2,conditions:{string:["equal","contain","startWith","endWith","notEqual","notContain","notStartWith","notEndWith","isEmpty"],number:["equal","greater","less","greaterEqual","lessEqual","notEqual","isEmpty"],date:["equal","before","after","range","isEmpty"],time:["equal","before","after","range","isEmpty"],"boolean":["equal","isEmpty"]},load:function(_5,_6){var F=gridx.modules.filter.Filter;F.before=F.lessEqual;F.after=F.greaterEqual;this.domNode=_1.create("div",{innerHTML:_4,"class":"dojoxGridxFilterBar"});_1.parser.parse(this.domNode);_1.toggleClass(this.domNode,"dojoxGridxFilterBarHideCloseBtn",!this.closeFilterBarButton);this.grid.vLayout.register(this,"domNode","headerNode",5);this._nls=_1.i18n.getLocalization("gridx","FilterBar");this._initWidgets();this.refresh();this.connect(this.domNode,"onclick","onDomClick");this.connect(this.domNode,"onmouseover","onDomMouseOver");this.connect(this.domNode,"onmousemove","onDomMouseMove");this.connect(this.domNode,"onmouseout","onDomMouseOut");this.loaded.callback();},onDomClick:function(e){if(!e.target||!e.target.tagName){return;}if(_1.attr(e.target,"action")==="clear"){this.clearFilter();}else{if(_1.hasClass(e.target,"dojoxGridxFilterBarCloseBtn")){this.hide();}else{this.showFilterDialog();}}},onDomMouseMove:function(e){if(e&&e.target&&(_1.attr(e.target,"action")==="clear"||this.btnFilter===_2.getEnclosingWidget(e.target))){return;}this._showTooltip(e);},onDomMouseOver:function(e){},onDomMouseOut:function(e){window.setTimeout(_1.hitch(this,"_hideTooltip"),10);},applyFilter:function(_7){var F=gridx.modules.filter.Filter,_8=[];this.filterData=_7;_1.forEach(_7.conditions,function(_9){var _a="string";if(_9.colId){_a=this.grid.column(_9.colId).dataType();_8.push(this._getFilterExpression(_9.condition,_9,_a,_9.colId));}else{var _b=[];_1.forEach(this.grid.columns(),function(_c){if(!_c.isFilterable()){return;}_b.push(this._getFilterExpression(_9.condition,_9,_a,_c.id));},this);_8.push(F.or.apply(F,_b));}},this);var _d=(_7.type==="all"?F.and:F.or).apply(F,_8);this.grid.filter.setFilter(_d);var _e=this;this.model.when({}).then(function(){_e._currentSize=_e.model.size();_e._totalSize=_e.model._cache.size();_e._buildFilterState();});},confirmToExecute:function(_f,_10){var max=this.ruleCountToConfirmClearFilter;if(this.filterData&&(this.filterData.conditions.length>=max||max<=0)){if(!this._cfmDlg){this._cfmDlg=new gridx.modules.filter.FilterConfirmDialog();}this._cfmDlg.execute=_1.hitch(_10,_f);this._cfmDlg.show();}else{_f.apply(_10);}},clearFilter:function(_11){if(!_11){this.confirmToExecute(_1.hitch(this,"clearFilter",true),this);}else{this.filterData=null;this.grid.filter.setFilter();this._buildFilterState();}},columnMixin:{isFilterable:function(){return this.grid._columnsById[this.id].filterable!==false;},setFilterable:function(_12){this.grid.filterBar._setFilterable(this.id,_12);return this;},dataType:function(){return (this.grid._columnsById[this.id].dataType||"string").toLowerCase();},filterConditions:function(){return this.grid.filterBar._getColumnConditions(this.id);}},refresh:function(){this.btnClose.style.display=this.closeFilterBarButton?"":"none";this.btnFilter.style.display=this.defineFilterButton?"":"none";},show:function(){this.domNode.style.display="block";this.grid.vLayout.reLayout();},hide:function(){this.domNode.style.display="none";this.grid.vLayout.reLayout();this._hideTooltip();},showFilterDialog:function(){var dlg=this._filterDialog;if(!dlg){this._filterDialog=dlg=new gridx.modules.filter.FilterDialog({grid:this.grid});}if(dlg.open){return;}dlg.setData(this.filterData);dlg.show();},_getColumnConditions:function(_13){var _14,_15;if(!_13){_14=[];_15="string";}else{_14=this.grid._columnsById[_13].disabledConditions||[];_15=(this.grid._columnsById[_13].dataType||"string").toLowerCase();}var ret=this.conditions[_15],_16={};if(!ret){ret=conditionData["string"];}_1.forEach(_14,function(_17){_16[_17]=true;});ret=_1.filter(ret,function(_18){return !_16[_18];});return ret;},_setFilterable:function(_19,_1a){var col=this.grid._columnsById[_19];if(!col){return;}if(col.filterable==!!_1a){return;}col.filterable=!!_1a;if(this.filterData){var d=this.filterData,len=d.conditions.length;d.conditions=_1.filter(d.conditions,function(c){return c.colId!=_19;});if(len!=d.conditions.length){this.applyFilter(d);}if(this._filterDialog.open){this._filterDialog.setData(d);}}},_initWidgets:function(){this.btnFilter=_2.byNode(_1.query(".dijitButton",this.domNode)[0]);this.btnClose=_1.query(".dojoxGridxFilterBarCloseBtn",this.domNode)[0];this.statusNode=_1.query(".dojoxGridxFilterBarStatus",this.domNode)[0].firstChild;},_buildFilterState:function(){var nls=this._nls;if(!this.filterData||!this.filterData.conditions.length){this.statusNode.innerHTML=nls.filterBarMsgNoFilterTemplate;return;}this.statusNode.innerHTML=_1.string.substitute(nls.filterBarMsgHasFilterTemplate,[this._currentSize,this._totalSize,"items"])+"&nbsp; &nbsp; <a href=\"javascript:void(0);\" action=\"clear\" title=\"Clear filter\">Clear Filter</a>";this._buildTooltip();},_buildTooltip:function(){if(!this._tooltip){this._tooltip=new gridx.modules.filter.FilterTooltip({grid:this.grid});}this._tooltip.buildContent();},_showTooltip:function(evt,_1b){this._hideTooltip();if(!this.filterData||!this.filterData.conditions||!this.filterData.conditions.length){return;}if(!_1b){this._pointTooltipDelay=window.setTimeout(_1.hitch(this,"_showTooltip",evt,true),this.tooltipDelay);return;}this._tooltip.show(evt);},_hideTooltip:function(){var dlg=this._tooltip;if(!dlg){return;}if(dlg.isMouseOn){return;}if(this._pointTooltipDelay){window.clearTimeout(this._pointTooltipDelay);this._pointTooltipDelay=null;}dlg.hide();},_getRuleString:function(_1c,_1d,_1e){var _1f,_1e;if(/^date|^time/i.test(_1e)){var f=this._formatDate;if(/^time/i.test(_1e)){f=this._formatTime;}if(_1c==="range"){var tpl=this._nls.rangeTemplate;_1f=_1.string.substitute(tpl,[f(_1d.start),f(_1d.end)]);}else{_1f=f(_1d);}}else{_1f=_1d;}return "<span style=\"font-style:italic\">"+this._getConditionDisplayName(_1c)+"</span> "+_1f;},_getConditionDisplayName:function(c){var k=c.charAt(0).toUpperCase()+c.substring(1);return this._nls["condition"+k];},_getConditionOptions:function(_20){var nls=this._nls;var _21=this._conditionOptions=this._conditionOptions||{};if(!_21[_20]){var arr=[];_1.forEach(this._getColumnConditions(_20),function(s){var k=s.charAt(0).toUpperCase()+s.substring(1);arr.push({label:nls["condition"+k],value:s});},this);_21[_20]=arr;}return _21[_20];},_getFilterExpression:function(_22,_23,_24,_25){var F=gridx.modules.filter.Filter;var dc=this.grid._columnsById[_25].dateParser||this.stringToDate;var tc=this.grid._columnsById[_25].timeParser||this.stringToTime;var c=_23.condition,exp,_26=false;if(c==="range"){var c={date:dc,time:tc},_27=F.value(_23.value.start,_24),_28=F.value(_23.value.end,_24),_29=F.column(_25,_24);exp=F.and(F.greaterEqual(_29,_27),F.lessEqual(_29,_28));}else{if(/^not/.test(c)){_26=true;c=c.replace(/^not/g,"");c=c.charAt(0).toLowerCase()+c.substring(1);}exp=F[c](F.column(_25,_24),F.value(_23.value,_24));if(_26){exp=F.not(exp);}}return exp;},_stringToDate:function(s,_2a){_2a=_2a||/(\d{4})\/(\d\d?)\/(\d\d?)/;_2a.test(s);var d=new Date();d.setYear()(parseInt(RegExp.$1));d.setMonth()(parseInt(RegExp.$2)-1);return d;},_stringToTime:function(s,_2b){_2b=_2b||/(\d\d?):(\d\d?):(\d\d?)/;_2b.test(s);var d=new Date();d.setHours(parseInt(RegExp.$1));d.setMinutes(parseInt(RegExp.$2));d.setSeconds(parseInt(RegExp.$3));return d;},_formatDate:function(_2c){var m=_2c.getMonth()+1,d=_2c.getDate();return m+"/"+d+"/"+_2c.getFullYear();},_formatTime:function(_2d){var h=_2d.getHours(),m=_2d.getMinutes();if(h<10){h="0"+h;}if(m<10){m="0"+m;}return h+":"+m+":00";}}));});