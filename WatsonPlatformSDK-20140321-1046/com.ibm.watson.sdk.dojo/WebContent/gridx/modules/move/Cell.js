//>>built
define("gridx/modules/move/Cell",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","../../core/_Module"],function(_1,_2,_3,_4){return _4.registerModule(_1("gridx.modules.move.Cell",_4,{name:"moveCell",getAPIPath:function(){return {move:{cell:this}};},cellMixin:{moveTo:function(_5,_6,_7){var _8=this.row.index(),_9=this.column.index();this.grid.move.cell.move({start:{row:_8,column:_9},end:{row:_8,column:_9}},_5,_6,_7);return this;}},copy:false,getEmptyValue:function(){return null;},move:function(_a,_b,_c,_d){this._skipUpdateBody=_d;_a=this._normalizeRange(_a);if((_a.start.row!==_b||_a.start.column!==_c)){if(this._checkAccept(_a,_b,_c)){this._doMove(_a,_b,_c);}else{return false;}}return true;},onMoved:function(){},_checkAccept:function(_e,_f,_10){var _11=this.arg("checkCellMoveAccept"),_12=_e.start,end=_e.end,tr,tc,i,j,_13,col,_14=this.grid.store,_15=this.grid.columns(),_16=this.model.size();for(i in this.model._cache._cache){i=this.model._cache._cache[i];if(_14.getIdentityAttributes){_13=_14.getIdentityAttributes(i.item);}else{if(_14.idProperty){_13=[_14.idProperty];}}break;}for(i=_12.row;i<=end.row;++i){tr=_f+i-_12.row;if(tr<0||tr>=_16){return false;}for(j=_12.column;j<=end.column;++j){tc=_10+j-_12.column;col=_15[tc];if(!col||!col.field()||(_13&&_2.indexOf(_13,col.field())>=0)||(_11&&!_11(i,j,tr,tc))){return false;}}}return true;},_normalizeRange:function(_17){var _18={},_19={},_1a=_17.start,end=_17.end;if(_1a.row<end.row){_18.row=_1a.row;_19.row=end.row;}else{_18.row=end.row;_19.row=_1a.row;}if(_1a.column<end.column){_18.column=_1a.column;_19.column=end.column;}else{_18.column=end.column;_19.column=_1a.column;}if(_18.row>=0&&_18.column>=0&&_19.row>=0&&_19.column>=0){return {start:_18,end:_19};}return null;},_doMove:function(_1b,_1c,_1d){var _1e=_1b.start,end=_1b.end,_1f=this.arg("copy"),_20=this.model,_21=end.row+1-_1e.row;_20.when([{start:_1e.row,count:_21},{start:_1c,count:_21}],function(){this._paste(_1b,_1c,_1d);var _22=this._getDiffRange(_1b,_1c,_1d);this._changeSelection(_22,_1b,_1c,_1d);if(!_1f){var _23=this.arg("getEmptyValue");this._walkDiffRange(_22,_1b,function(_24){_24.setRawData(_23(_24));});}this._moveComplete(_1b,_1c,_1d);},this);},_getDiffRange:function(_25,_26,_27){var _28=_25.start,end=_25.end,ret={};if((_26>=_28.row*2-end.row+1&&_26<=end.row)||(_27>=_28.column*2-end.column+1&&_27<=end.column)){if(_28.row<_26){ret.rowRange={start:_28.row,mid:_26,end:end.row+1,dir:1};}else{ret.rowRange={start:end.row,mid:_26+end.row-_28.row,end:_28.row-1,dir:-1};}if(_28.column<_27){ret.colRange={start:_28.column,end:_27-1};}else{ret.colRange={start:_27+end.column-_28.column+1,end:end.column};}}else{ret.rowRange={start:_28.row,mid:end.row+1,dir:1};}return ret;},_paste:function(_29,_2a,_2b){var _2c=_29.start,end=_29.end,i,j,_2d,row,tmp=[],_2e=this.grid.columns();for(i=_2c.row;i<=end.row;++i){_2d=this.model.byIndex(i);tmp[i]=[];for(j=_2c.column;j<=end.column;++j){tmp[i][j]=_2d.data[_2e[j].id];}}for(i=_2c.row;i<=end.row;++i){row=this.grid.row(_2a+i-_2c.row);for(j=_2c.column;j<=end.column;++j){row.cell(_2b+j-_2c.column).setRawData(tmp[i][j]);}}},_changeSelection:function(_2f,_30,_31,_32){var _33=this.grid.select&&this.grid.select.cell;if(_33){var _34=_30.start,end=_30.end,r,c,tr,tc,rid,cid,_35,_36,tmp=[],_37=this.model,_38=this.grid._columns;for(r=_34.row;r<=end.row;++r){rid=_37.indexToId(r);tmp[r]=[];for(c=_34.column;c<=end.column;++c){cid=_38[c].id;tmp[r][c]=_33.isSelected(rid,cid);}}for(r=_34.row;r<=end.row;++r){tr=_31+r-_34.row;rid=_37.indexToId(r);_35=_37.indexToId(tr);for(c=_34.column;c<=end.column;++c){tc=_32+c-_34.column;cid=_38[c].id;_36=_38[tc].id;_33[tmp[r][c]?"selectById":"deselectById"](_35,_36);}}this._walkDiffRange(_2f,_30,function(_39){_33.deselectById(_39.row.id,_39.column.id);});}},_walkDiffRange:function(_3a,_3b,_3c){var i,j,row,_3d,_3e=_3a.rowRange,_3f=_3a.colRange;for(i=_3e.start;i!==_3e.mid;i+=_3e.dir){row=this.grid.row(i);for(j=_3b.start.column;j<=_3b.end.column;++j){_3d=row.cell(j);_3c(_3d);}}if(_3f){for(i=_3e.mid;i!==_3e.end;i+=_3e.dir){row=this.grid.row(i);for(j=_3f.start;j<=_3f.end;++j){_3d=row.cell(j);_3c(_3d);}}}},_moveComplete:function(_40,_41,_42){if(this._skipUpdateBody){this.grid.body.autoUpdate=this._savedAutoUpdate;var _43=Math.min(_40.start.row,_41);var _44=Math.max(_40.end.row,_41+_40.end.row-_40.start.row+1);this.grid.body.refresh(_43,_44+1-_43);}this.onMoved(_40,_41,_42);}}));});