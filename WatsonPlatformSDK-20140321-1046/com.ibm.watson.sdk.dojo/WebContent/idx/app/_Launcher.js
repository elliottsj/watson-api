//>>built
define("idx/app/_Launcher",["dojo/_base/declare","dijit/layout/_LayoutWidget","./_A11yAreaProvider","dojo/_base/lang","dojo/_base/array","dojo/aspect","dojo/topic","dojo/query","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojo/cookie","../resources","../string","../util","../bus","./Workspace","./WorkspaceType","dojo/NodeList-dom","dojo/i18n!../nls/base","dojo/i18n!./nls/base","dojo/i18n!./nls/_Launcher"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12){var _13=_8.NodeList;return _1("idx.app._Launcher",[_2,_3],{defaultWorkspaceTypeID:"",stateCookieName:"",resources:null,constructor:function(_14,_15){this._workspaceTypes=new Array();this._workspacesByType=new Array();this._workspacesByID=new Array();this._workspaceTypesByID=new Array();this._workspaceCallersByID=new Array();this._nextWorkspaceID=0;this._launcherStarted=false;this._workspaceCount=0;this._selectedWorkspace=null;this.subscriberScopeFilter="idx.app.launcher";this.subscriberScopeRegexp=false;},destroy:function(){for(var _16 in this._workspaceCallersByID){var _17=this._workspaceCallersByID[_16];if(_17.handle){_17.handle.remove();delete _17.handle;}delete this._workspaceCallersByID[_16];}this.inherited(arguments);},postMixInProperties:function(){var _18=_d.getResources("idx/app/_Launcher",this.lang);if(this.resources){var _19=new Object();_4.mixin(_19,_18);_4.mixin(_19,this.resources);this.resources=_19;}else{this.resources=_18;}this._initialWSTypeIDs=new Array();var _1a=null;this.stateCookieName=_e.nullTrim(this.stateCookieName);if(this.stateCookieName!=null){_1a=_e.nullTrim(_c(this.stateCookieName));if(_1a!=null){this._initialWSTypeIDs.push(_1a);}}_1a=_e.nullTrim(this.defaultWorkspaceTypeID);if(_1a!=null){this._initialWSTypeIDs.push(_1a);}},openWorkspace:function(_1b,_1c){var _1d=this._workspaceTypesByID[_1b];if(_1d==null){_10.systemError(this,"Workspace could not be opened.  Workspace type is not known: ${workspaceTypeID}",{workspaceTypeID:_1b},null,"Unknown workspace type: "+_1b,true);}var _1e=this.getOpenWorkspaceCount(_1b);var _1f=_1d.get("maxOpen");if((_1f==1)&&(_1e==1)){var _20=this._workspacesByType[_1b];var _21=_20[0];this.selectWorkspace(_21);return _21;}if((_1f>0)&&(_1e>=_1f)){_10.userError(this,this.resources.tooManyOpenWorkspaces,{maxOpen:_1f,workspaceTypeName:_1d.workspaceTypeName},null,"Exceeded maximum open workspaces for workspace type: opened=[ "+_1e+" ], maxOpen=[ "+_1f+" ], typeID=[ "+_1b+" ], typeName=[ "+_1d.workspaceTypeName+" ]");return null;}var _22=_1d.formatTitle(_1c);var _23=-1;var _24=this.getWorkspaces();for(var _25=0;_25<_24.length;_25++){var pw=_24[_25];var _26=pw.get("baseTitle");if(_22==_26){var _27=pw.get("titleSuffixIndex");if(_27>_23){_23=_27;}}}if(_23>=0){var _28=_23+1;var _29=" ("+_28+") ";_22={baseTitle:_22,title:(_22+_29),titleSuffixIndex:_28};}return this._doOpenWorkspace(_1d,_22,_1c);},_doOpenWorkspace:function(_2a,_2b,_2c){var _2d=_2a.workspaceTypeID+":"+(this._nextWorkspaceID++)+"-"+(100000+Math.floor(Math.random()*900000));var _2e=this._createWorkspace(_2a,_2d,_2b,_2c);_a.add(_2e.domNode,this.getWorkspaceStyleClass());this._workspacesByID[_2d]=_2e;this._workspacesByType[_2a.workspaceTypeID].push(_2e);this.connect(_2e,"onDownloadEnd","resize");this._workspaceCreated(_2e);_2e.startup();return _2e;},_createWorkspace:function(_2f,_30,_31,_32){var _33=this._createWorkspaceArgs(_2f,_30,_31,_32);var _34=new _11(_33);var _35={launcher:this,workspace:_34,handle:null,loaded:function(_36){this.launcher.workspaceLoaded(this.workspace,_36);if(this.handle){this.handle.remove();}delete this.handle;}};_35.handle=_6.after(_34,"onLoad",_4.hitch(_35,_35.loaded),true);this._workspaceCallersByID[_34.workspaceID]=_35;return _34;},_createWorkspaceArgs:function(_37,_38,_39,_3a){var _3b={};if(_e.nullTrim(this.lang)){_3b.lang=this.lang;}if(_e.nullTrim(this.dir)){_3b.dir=this.dir;}var _3c=_37.get("lang");var _3d=_37.get("dir");if(_e.nullTrim(_3c)){_3b.lang=_3c;}if(_e.nullTrim(_3d)){_3b.dir=_3d;}var _3e={workspaceID:_38,workspaceTypeID:_37.workspaceTypeID,workspaceArgs:_3a,loadingMessage:this.getLoadingMessage(_37,_39,_3a),errorMessage:this.getFailedLoadMessage(_37,_39,_3a),href:_37.formatURL(_3a),preventCache:true,refreshOnShow:false,parseOnLoad:true,inferLabel:false};if(_f.typeOfObject(_39)=="string"){_3e.title=_39;_3e.baseTitle=_39;}else{_3e.title=_39.title;_3e.baseTitle=_39.baseTitle;_3e.titleSuffixIndex=_39.titleSuffixIndex;}var _3f=_37.get("workspaceArgs");if(_3f){for(field in _3b){if(!(field in _3f)){_3e[field]=_3b[field];}}}_4.mixin(_3e,_3f);return _3e;},selectWorkspace:function(_40){},onWorkspaceSelected:function(_41,_42){},_onWorkspaceSelected:function(_43,_44){if(_44===_43){return;}this._selectedWorkspace=_43;this._saveStateToCookie();this.onWorkspaceSelected(_43,_44);},_saveStateToCookie:function(){if(_e.nullTrim(this.stateCookieName)==null){return;}if(this._selectedWorkspace==null){_c(this.stateCookieName,null,{expires:-1});}else{_c(this.stateCookieName,this._selectedWorkspace.get("workspaceTypeID"),{expires:365});}},_selectDefaultWorkspace:function(){var _45=0;var _46=null;var _47=this._initialWorkspaceTypeID;if((_47!=null)&&(_47.length>0)&&(this.getOpenWorkspaceCount(_47)>0)){var _48=this._workspacesByType[_47];_46=_48[0];}for(_45=0;((_45<this._workspaceTypes.length)&&(_46==null));_45++){var _49=this._workspaceTypes[_45];_47=_49.get("workspaceTypeID");if((!_46)&&(this.getOpenWorkspaceCount(_47)>0)){var _48=this._workspacesByType[_47];_46=_48[0];}}if(_46){this.selectWorkspace(_46);this._selectedWorkspace=_46;this._saveStateToCookie();}},workspaceLoaded:function(_4a,_4b){},getWorkspaceStyleClass:function(_4c,_4d){return this.baseClass+"_Workspace";},_workspaceCreated:function(_4e){this._workspaceCount++;if(this._workspaceCount==1){this.selectWorkspace(_4e);}},getFailedLoadMessage:function(_4f,_50,_51){var msg=this._getFailedLoadMessage(_4f,_50,_51);return "<div class='dijitContentPaneError'>"+msg+"</div>";},_getFailedLoadMessage:function(_52,_53,_54){var msg=_52.formatFailedLoadMessage(_53,_54);if((msg!=null)&&(msg.length>0)){return msg;}var _55=this.resources.failedLoadMessageTemplate;if((!_55)||(_55.length==0)){return "";}msg=dString.substitute(_55,{workspaceTitle:_53});if(_54){msg=dString.substitute(msg,_54);}return msg;},getLoadingMessage:function(_56,_57,_58){var msg=this._getLoadingMessage(_56,_57,_58);return "<div class='dijitContentPaneLoading'>"+msg+"</div>";},_getLoadingMessage:function(_59,_5a,_5b){var msg=_59.formatLoadingMessage(_5a,_5b);if((msg!=null)&&(msg.length>0)){return msg;}var _5c=this.resources.failedLoadMessageTemplate;if((!_5c)||(_5c.length==0)){return "";}var msg=dString.substitute(_5c,{workspaceTitle:_5a});if(_5b){msg=dString.substitute(msg,_5b);}return msg;},closeWorkspace:function(_5d){var _5e=this._workspacesByID[_5d];if(!_5e){return null;}var _5f=_5e.get("workspaceTypeID");var _60=this._workspaceTypesByID[_5f];if(!_60){_10.systemError(this,"Workspace could not be closed.  Workspace type is not known: ${workspaceTypeID}",{workspaceTypeID:_5f},null,"Unknown workspace type: "+_5f,true);}var _61=_60.formatConfirmCloseMessage(_5e);if(_61){var _62=false;if(_62){return false;}}var _63=this._workspaceClosing(_5e);var _64=this._workspacesByType[_5f];var _65=_5.indexOf(_64,_5e);if(_65>=0){_64.splice(_65,1);}var _66=this._workspaceCallersByID[_5e.workspaceID];if(_66){if(_66.handle){_66.handle.remove();delete _66.handle;}delete this._workspaceCallersByID[_5e.workspaceID];}if(!_63){_5e.destroyRecursive();}this._workspaceClosed(_5e);return _5f;},_workspaceClosing:function(_67){return false;},_workspaceClosed:function(_68){this._workspaceCount--;},startup:function(){if(this._launcherStarted){return;}this.inherited(arguments);_5.forEach(this.getChildren(),this._setupChild,this);this._initialWorkspaceTypeID=null;var _69=0;for(_69=0;((_69<this._initialWSTypeIDs.length)&&(this._initialWorkspaceTypeID==null));_69++){var _6a=this._initialWSTypeIDs[_69];var _6b=this._workspaceTypesByID[_6a];if(_6b!=null){var _6c=_6b.get("initialOpen");if(_6c>0){this._initialWorkspaceTypeID=_6a;}}}var _6d=0;for(_6d=0;_6d<this._workspaceTypes.length;_6d++){var _6b=this._workspaceTypes[_6d];var _6c=_6b.get("initialOpen");var _6e=0;for(_6e=0;_6e<_6c;_6e++){this.openWorkspace(_6b.workspaceTypeID,null);}}if((this.launcherTopic)&&(this.launcherTopic.length>0)){_7.subscribe(this.launcherTopic,_4.hitch(this,this.handleRequest));}this._selectDefaultWorkspace();this._launcherStarted=true;},selectFirstWorkspaceOfType:function(_6f){var _70=this.getWorkspaces(_6f);if(!_70){return null;}if(_70.length==0){return null;}var _71=_70[0];this.selectWorkspace(_71);return _71;},getWorkspaceTypeIDs:function(){var _72=new Array();for(var _73=0;_73<this._workspaceTypes.length;_73++){workspaceType=this._workspaceTypes[_73];_72.push(workspaceType.get("workspaceTypeID"));}return _72;},getWorkspaces:function(_74){var _75=new Array();if(_74){var _76=this._workspacesByType[_74];if(!_76){return _75;}for(var _77=0;_77<_76.length;_77++){_75.push(_76[_77]);}return _75;}else{var _78=this.getChildren();for(var _77=0;_77<_78.length;_77++){var _79=_78[_77];if(!(_79 instanceof _11)){continue;}var _7a=_79.get("workspaceID");if(this._workspacesByID[_7a]!=_79){continue;}_75.push(_79);}return _75;}},getWorkspace:function(_7b){return this._workspacesByID[_7b];},_setupChild:function(_7c,_7d){this.inherited(arguments);if(_7c instanceof _12){var _7e=_7c.get("workspaceTypeID");if(this._workspaceTypesByID[_7e]){_10.systemError(this,this.resources.duplicateWorkspaceTypeError,{workspaceTypeID:_7c.workspaceTypeID},null,"Duplicate workspace type key: "+_7c.workspaceTypeID,true);}this._workspaceTypes.push(_7c);this._workspaceTypesByID[_7e]=_7c;this._workspacesByType[_7e]=new Array();this._workspaceTypeRegistered(_7c);this._relocateWorkspaceType(_7c,_7d);if(this._launcherStarted){var _7f=_7c.get("initialOpen");var _80=0;for(_80=0;_80<_7f;_80++){this.openWorkspace(_7c.workspaceTypeID,null);}}}},removeChild:function(_81){var _82=null;if(typeof _81=="number"){var _83=this.getChildren();if((_81>=0)||(_81<_83.length)){_82=this.getChildren()[_81];}}else{_82=_81;}if(_82&&(_82 instanceof _12)){var _84=_82.get("workspaceTypeID");var _85=-1;var _86=0;_5.forEach(this._workspaceTypes,function(_87){if(_87===_82){_85=_86;}_86++;});if(_85>=0){var _88=this._workspacesByType[_84];var _89=this;if(_88){_88=_88.slice(0);_5.forEach(_88,function(_8a){_89.closeWorkspace(_8a.workspaceID);});}this._workspaceTypes.splice(_85,1);if(this._workspaceTypesByID[_84]){delete this._workspaceTypesByID[_84];}if(this._workspacesByType[_84]){delete this._workspacesByType[_84];}this._workspaceTypeUnregistered(_82);}}this.inherited(arguments);},_relocateWorkspaceType:function(_8b,_8c){var _8d=new _13(_8b.domNode);_8d.orphan();_9.place(_8b.domNode,this.containerNode,"last");_b.set(_8b.domNode,{visibility:"hidden",display:"none"});},_workspaceTypeRegistered:function(_8e){},_workspaceTypeUnregistered:function(_8f){},getOpenWorkspaceCount:function(_90){var arr=this._workspacesByType[_90];if(!arr){return 0;}return arr.length;},getMaxOpenWorkspaceCount:function(_91){var _92=this._workspaceTypesByName[_91];if(!_92){return -1;}return _92.get("maxOpen");}});});