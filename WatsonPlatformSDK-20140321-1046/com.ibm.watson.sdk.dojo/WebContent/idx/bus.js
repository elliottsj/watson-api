//>>built
define("idx/bus",["dojo/_base/lang","idx/main","dojo/_base/json","dojo/_base/connect","dojo/string","dijit/_WidgetBase","dijit/_base/manager","idx/bus/BusMessage","idx/string","idx/util"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){var _b=_1.getObject("bus",true,_2);_b.DEFAULT_BUS_TOPIC="idx.bus";_b.NOTIFICATIONS="idx.bus.notifications";_b.QUERIES="idx.bus.queries";_b.DEBUG="DEBUG";_b.INFO="INFO";_b.WARNING="WARNING";_b.USER_ERROR="USER_ERROR";_b.SYSTEM_ERROR="SYSTEM_ERROR";_b.ALERT="ALERT";_b.CONFIRM="CONFIRM";_b.CHOOSE="CHOOSE";_b.PROMPT="PROMPT";_b.publish=function(_c,_d,_e,_f,_10,_11){_11=_9.nullTrim(_11);var _12=null;if(_11!=null){_12={topic:_11,widget:null};}else{_12=_b._getBusTopic(_e);}var msg=new _8({scope:_c,messageType:_d,source:_e,broadcast:_f,args:_10});return _b._publish(_12,msg);};_b._publish=function(_13,msg){var _14=[];var _15=[];while(_13!=null){if(_14[_13.topic]==true){break;}_14[_13.topic]=true;_15.push(_13.topic);_4.publish(_13.topic,[msg]);var _16=msg.isHandled();if((!_16)||(broadcast)){_13=_b._getPropagateBusTopic(_13);}else{_13=null;}}return msg;};_b.debug=function(_17,_18,_19,_1a,_1b,_1c,_1d){return _b.notify(_17,_b.DEBUG,_18,_19,_1a,_1b,_1c,_1d);};_b.info=function(_1e,_1f,_20,_21,_22,_23,_24){return _b.notify(_1e,_b.INFO,_1f,_20,_21,_22,_23,_24);};_b.warning=function(_25,_26,_27,_28,_29,_2a,_2b){return _b.notify(_25,_b.WARNING,_26,_27,_28,_29,_2a,_2b);};_b.userError=function(_2c,_2d,_2e,_2f,_30,_31,_32){return _b.notify(_2c,_b.USER_ERROR,_2d,_2e,_2f,_30,_31,_32);};_b.systemError=function(_33,_34,_35,_36,_37,_38,_39){return _b.notify(_33,_b.SYSTEM_ERROR,_34,_35,_36,_37,_38,_39);};_b.notify=function(_3a,_3b,_3c,_3d,_3e,_3f,_40,_41){var _42=_b.publish(_b.NOTIFICATIONS,_3b,_3a,true,{messageTemplate:_3c,messageArgs:_3d,messageID:_3e,internalMessage:_3f},_41);if(_40){var msg=(((_3b)?(_3b+": "):"")+((_3e)?(_3e+": "):"")+((_3f)?_3f:_5.substitute(_3c,_3d)));throw new Error(msg);}};_b._getBusTopic=function(_43,_44){var _45=_44;if(_45==null){_45={topic:null,widget:null};}else{_45.topic=null;_45.widget=null;}if(_43 instanceof _6){_45.widget=_43;}else{if(_a.isNodeOrElement(_43)){_45.widget=_7.getEnclosingWidget(_43);}else{_45.widget=null;}}if((_45.widget!=null)&&(_45.widget._idx_getBusTopic)){_45.topic=_9.nullTrim(_45.widget._idx_getBusTopic());}while((_45.topic==null)&&(_45.widget!=null)){_45.widget=_b._getParentBusWidget(_45.widget);if(_45.widget){_45.topic=_9.nullTrim(_45.widget._idx_getBusTopic());}}if(_45.topic==null){_45.topic=_b.DEFAULT_BUS_TOPIC;_45.widget=null;}return _45;};_b._getPropagateBusTopic=function(_46){var _47=null;if(_46 instanceof _6){_47=_b._getBusTopic(_46);}else{_47=_46;}var _48=_47.topic;_47.topic=null;if(_47.widget==null){return null;}_47.widget=_b._getParentBusWidget(_47.widget);while((_47.widget!=null)&&(_47.topic==null)){_47=_b._getBusTopic(_47.widget,_47);if(_47.topic==_48){_47.topic=null;if(_47.widget!=null){_47.widget=_b._getParentBusWidget(_47.widget);}}}if((_47.topic==null)||(_47.topic==_48)){return null;}return _47;};_b._getParentBusWidget=function(_49){var _4a=_a.getParentWidget(_49);while((_4a!=null)&&((!_4a._idx_getBusTopic)||(!_4a._idx_getPropogateBusTopic))){_4a=_a.getParentWidget(_4a);}return _4a;};return _b;});