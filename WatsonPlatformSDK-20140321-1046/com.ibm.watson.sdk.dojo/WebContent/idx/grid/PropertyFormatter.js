//>>built
require({cache:{"url:idx/grid/templates/PropertyFormatter.html":"<div class=\"${baseClass}\"\r\n><div id=\"${id}_format\" tabindex=\"0\" dojoAttachPoint=\"formatNode,focusNode\" class=\"${baseClass}Format\"></div\r\n><div id=\"${id}_edit\" dojoAttachPoint=\"containerNode\" class=\"${baseClass}Edit\"></div\r\n></div>\r\n"}});define("idx/grid/PropertyFormatter",["dojo/_base/declare","dijit/_WidgetBase","dijit/_Widget","dijit/_TemplatedMixin","dijit/_Container","dojo/_base/lang","dojo/_base/array","dojo/string","dojo/number","dojo/date/locale","dojo/Deferred","dojo/when","dojo/aspect","dojo/json","dojo/dom-class","dijit/registry","../util","../string","../resources","./PropertyEditAdaptor","../widget/EditController","dojo/text!./templates/PropertyFormatter.html","dojo/i18n!../nls/base","dojo/i18n!./nls/base","dojo/i18n!./nls/PropertyFormatter"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16){var _17=new function(){};return _1("idx.grid.PropertyFormatter",[_3,_4,_5],{data:null,propertyName:"",properties:"",format:"",altSyntax:false,emptyFormat:"",readOnly:false,disabled:false,formatFunc:_17,toEditFunc:null,fromEditFunc:null,dateFormatOptions:null,timeFormatOptions:null,dateTimeFormatOptions:null,decimalFormatOptions:null,integerFormatOptions:null,percentFormatOptions:null,currencyFormatOptions:null,propertyContainer:null,autoDestroyWidgetFormats:true,editController:null,baseClass:"idxPropertyFormatter",templateString:_16,constructor:function(_18,_19){this._started=false;this.emptyFormat=null;this._editmode=false;this._editorHandles={};},destroy:function(){if(this.autoDestroyWidgetFormats&&this._widgetValue){this._widgetValue.destroy();delete this._widgetValue;}if(this._controllerHandle){this._controllerHandle.remove();delete this._controllerHandle;}if(this._editorHandles){for(var _1a in this._editorHandles){var _1b=this._editorHandles[_1a];if(_1b){_1b.remove();}delete this._editorHandles[_1a];}}if(this._editController){this._editController.destroyRecursive();delete this._editController;}if(this._editorsByOrder){_7.forEach(this._editorsByOrder,function(_1c){_1c.destroyRecursive();delete _1c;});delete this._editorsByOrder;}var _1d=this.getChildren();if(_1d){_7.forEach(_1d,function(_1e){_1e.destroyRecursive();});}this.inherited(arguments);},_stringSubstitute:function(_1f,map){var _20=((this.altSyntax)?/\$\[([^\s\]]+)\]/g:/\$\{([^\s\}]+)\}/g);return _1f.replace(_20,function(_21,key){var _22=_6.getObject(key,false,map);return _22;});},postMixInProperties:function(){_11.nullify(this,this.params,["formatFunc"]);this.inherited(arguments);},buildRendering:function(){this.inherited(arguments);},postCreate:function(){this.inherited(arguments);},startup:function(){if(this._started){return;}this.inherited(arguments);if(this._widgetValue&&(!this._widgetValue._started)){this._widgetValue.startup();}this._reformat();this._updateEditors();},addChild:function(_23,_24){this.inherited(arguments);if(this._started){this._updateEditors();}},isEditorValid:function(){var _25=true;if(this._editorsByName){for(var _26 in this._editorsByName){var _27=this._editorsByName[_26];if(!_27){continue;}var _28=_27.propertyEditAdaptor;if(!_28){continue;}if(!_28.isEditorValid(_27)){_25=false;}}}return _25;},_onEditorChange:function(_29,_2a){if(!this._editMode){return;}var _2b=_29.get("id");if(this._namesByEditorID){var _2c=this._namesByEditorID[_2b];if(_2c){this.onEditorChange(_2c,_2a,this);}}},removeChild:function(_2d){this.inherited(arguments);var _2e=_2d.get("id");if(_2e in this._editorHandles){var _2f=this._editorHandles[_2e];if(_2f){_2f.remove();}delete this._editorHandles[_2e];}if(this._started){this._updateEditors();}},_updateEditors:function(){if(!this._started){return;}if(this.getChildren().length==0){_f.add(this.domNode,this.baseClass+"NoEditors");}else{_f.remove(this.domNode,this.baseClass+"NoEditors");}this._mapEditors();this._updateEditController();},_getEditController:function(){if(this.editController){return this.editController;}if(this._editController){return this._editController;}if(this.propertyContainer){var _30=this.propertyContainer.get("editController");return _30;}return null;},_setEditControllerAttr:function(_31){this.editController=_10.byId(_31);this._updateEditController();},_setPropertyContainerAttr:function(_32){this.propertyContainer=_32;if(this._controllerHandle){this._controllerHandle.remove();delete this._controllerHandle;}if(_32){this._controllerHandle=_d.after(_32,"onEditControllerChanged",_6.hitch(this,"_updateEditController"),true);}this._updateEditController();this._reformat();},_updateEditController:function(){if(!this._started){return;}var _33=this._getEditController();if(this._linkedController&&(this._linkedController!=_33)){this._linkedController.unlinkEditor(this);this._linkedController=null;}if(!_33&&this.getChildren().length>0&&!this._editController){this._editController=new _15({readOnly:this.readOnly,disabled:this.disabled,readControlledNodeIDs:this.formatNode.id,editControlledNodeIDs:this.containerNode.id});this._editController.startup();this._editController.placeAt(this.domNode,"last");}if(this._editController&&((_33&&(_33!==this._editController))||this.getChildren().length==0)){this._editController.destroyRecursive();delete this._editController;this._editController=null;}if(!_33&&this._editController){_33=this._editController;}if(_33&&(!this._linkedController)){_33.linkEditor(this,{onSave:"_onSave",onCancel:"_onCancel",onEdit:"_onEdit",readNodeIDs:this.formatNode.id,editNodeIDs:this.containerNode.id});this._linkedController=_33;}},_mapEditors:function(){if(!this._started){return;}if(!this.properties){this._editorsByName=null;return;}var _34=this.getChildren();var _35=[];var _36=[];var _37=[];var _38=[];var _39=0;var _3a=0;for(var _3b=0;_3b<_34.length;_3b++){var _3c=_34[_3b];var _3d=_3c.propertyEditAdaptor;if(_3d&&_3d.isEditor(_3c)){_39++;var _3e=_3c.get("id");var _3f=_3d.getEditorChangeEvent(_3c);if((!(_3e in this._editorHandles))&&(_3f)){var _40=this;var _41=function(_42){_40._onEditorChange(_3c,_42);};var _43=_d.after(_3c,_3f,_41,true);this._editorHandles[_3e]=_43;}_38.push(_3c);var _44=_3d.getPropertyName(_3c);if(_12.nullTrim(_44)){if(this._propsByName[_44]){_3a++;}var _3e=_3c.get("id");_35[_44]=_3c;_36[_3e]=_44;}else{_37.push(_3c);}}}var _45=0;for(var _3b=0;_3b<this._properties.length;_3b++){var _46=this._properties[_3b];if(!(_46 in _35)){_45++;}}if((_45>0)&&(_45==_37.length)){var _47=0;for(var _3b=0;_3b<this._properties.length;_3b++){var _48=this._properties[_3b];var _46=_48.propName;var _49=_35[_46];if(_49){continue;}if(_47>=_37.length){continue;}_49=_37[_47++];var _4a=_49.get("id");_35[_46]=_49;_36[_4a]=_46;}}if(this._editorsByName){delete this.editorsByName;}if(this._namesByEditorID){delete this._namesByEditorID;}if(this._editorsByOrder){delete this._editorsByOrder;}this._editorsByName=_35;this._namesByEditorID=_36;this._editorsByOrder=_38;},_setDataAttr:function(_4b){this.data=_4b;this._reformat();},_setFormatAttr:function(_4c){this.format=_4c;this._reformat();},_setEmptyFormatAttr:function(_4d){this.emptyFormat=_4d;this._reformat();},_setFormatFuncAttr:function(_4e){this.formatFunc=_4e;this._reformat();},_setDateFormatOptionsAttr:function(_4f){this.dateFormatOptions=_4f;this._reformat();},_setTimeFormatOptionsAttr:function(_50){this.timeFormatOptions=_50;this._reformat();},_setDateTimeFormatOptionsAttr:function(_51){this.dateTimeFormatOptions=_51;this._reformat();},_setDecimalFormatOptionsAttr:function(_52){this.decimalFormatOptions=_52;this._reformat();},_setIntegerFormatOptionsAttr:function(_53){this.integerFormatOptions=_53;this._reformat();},_setPercentFormatOptionsAttr:function(_54){this.percentFormatOptions=_54;this._reformat();},_setCurrencyFormatOptionsAttr:function(_55){this.currencyFormatOptions=_55;this._reformat();},_setPropertiesAttr:function(_56){this.properties=_56;this._properties=[];this._propsByName=[];this._defaultFormat="";var _57="";if(this.properties!=null){var _58=this.properties.split(",");var _59=0;for(_59=0;_59<_58.length;_59++){var _5a=this._parsePropertyName(_58[_59]);var _5b=_5a.propName;this._properties.push(_5a);this._propsByName[_5b]=_5a;this._defaultFormat=(this._defaultFormat+_57+"${"+_5b+"}");_57=", ";}}this._reformat();},_parsePropertyName:function(_5c){var _5d=[];var _5c=_8.trim(_5c);var _5e=null;var _5f=_5c.lastIndexOf("(");var _60=_5c.lastIndexOf(")");var _61=_5c;if((_5f>=0)&&(_60==(_5c.length-1))){_5e=_5c.substring(_5f+1,_60);_5e=_8.trim(_5e);_5c=_8.trim(_5c.substring(0,_5f));_61=_5c;}var dot=_5c.indexOf(".");var _62=_5c.indexOf(this.altSyntax?"(":"[");while((dot>=0)||(_62>=0)){var _63=null;if((dot>=0)&&((_62<0)||(dot<_62))){_63=_8.trim(_5c.substring(0,dot));if(dot<(_5c.length-1)){_5c=_8.trim(_5c.substring(dot+1));}else{_5c="";}_5d.push(_63);}else{var _64=_5c.indexOf(this.altSyntax?")":"]");var _65=this._makeNumber(_8.trim(_5c.substring(_62+1,_64)));_63=_8.trim(_5c.substring(0,_62));if(_64<(_5c.length-1)){_5c=_8.trim(_5c.substring(_64+1));}else{_5c="";}if(_5c.charAt(0)=="."){_5c=_5c.substring(1);}if(_63.length>0){_5d.push(_63);}_5d.push(_65);}dot=_5c.indexOf(".");_62=_5c.indexOf(this.altSyntax?"(":"[");}if(_5c.length>0){_5d.push(_5c);}return {propName:_61,propType:_5e,propParts:_5d};},_reformat:function(){if(!this._started){return;}var _66=this._getFormattedValue();var _67=new _b();_c(_66,_6.hitch(this,function(_68){if(_68&&this._widgetValue===_68){}else{if(_68 instanceof _2){if(this.autoDestroyWidgetFormats&&this._widgetValue){this._widgetValue.destroy();delete this._widgetValue;}_68.placeAt(this.formatNode,"only");if(this._started&&(!_68._started)){_68.startup();}this._widgetValue=_68;}else{this.formatNode.innerHTML=_68;}}_67.resolve(_68);}));return _67;},refresh:function(){var _69=this._getData();var _6a=this.propertyContainer;var d=this._reformat();_c(d,_6.hitch(this,function(_6b){this.onRefresh(_69,this,_6a);}));return d;},_customFormat:function(_6c){var _6d=null;if(this.formatFunc&&this.formatFunc!==_17){_6d=this.formatFunc.call(this,_6c);}if(_6d!=null){return _6d;}if(this.propertyContainer){var _6e=this.propertyContainer.get("formatFunc");if(_6e){_6d=_6e.call(this.propertyContainer,this.propertyName,_6c);}}return _6d;},_getFormattedValue:function(){var _6f=this._getData();var _70=this._customFormat(_6f);if(_70!=null){return _70;}var _71=new Object();var _72=0;if(!this._properties){return "";}for(_72=0;_72<this._properties.length;_72++){var _73=this._properties[_72];var _74=(_6f)?this._resolveValue(_6f,_73.propParts):null;if((_74==null)&&(_73.propParts.length==1)){_71[_73.propName]=this._getEmptyFormat();continue;}var _75=_71;for(var _76=0;_76<_73.propParts.length;_76++){var key=_73.propParts[_76];if(_11.typeOfObject(key)=="number"){key="__arrindex_"+key;}if(_76<(_73.propParts.length-1)){if(!(_75[key])){_75[key]={};}_75=_75[key];}else{var _77=key+"__fmtTxt_";_75[_77]=this._formatPart(_74,_73.propType);}}}var _78=this.format;if(_12.nullTrim(_78)==null){_78=this._defaultFormat;}var _79=_78;do{_78=_79;_79=_78.replace((this.altSyntax?/(\x24\x5b[^\x5d\x28\x29]+)\x28(\x2d?[0-9]+)\x29([^\x5b\x5d]*\x5d)/g:/(\x24\x7b[^\x7d\x5b\x5d]+)\x5b(\x2d?[0-9]+)\x5d([^\x7b\x7d]*\x7d)/g),"$1.__arrindex_$2$3");}while(_79!=_78);do{_78=_79;_79=_78.replace((this.altSyntax?/(\x24\x5b[^\x5d\x7c]+)(\x5d)/g:/(\x24\x7b[^\x7d\x7c]+)(\x7d)/g),"$1__fmtTxt_|$2");}while(_79!=_78);do{_78=_79;_79=_78.replace((this.altSyntax?/(\x24\x5b[^\x5d\x7c]+)\x7c(\x5d)/g:/(\x24\x7b[^\x7d\x7c]+)\x7c(\x7d)/g),"$1$2");}while(_79!=_78);_78=_79;_70=this._stringSubstitute(_78,_71);if(_12.nullTrim(_70)==null){_70=this._getEmptyFormat();}return _70;},_resolveValue:function(_7a,_7b){var _7c=_7a;for(var _7d=0;_7d<_7b.length;_7d++){var key=_7b[_7d];if((_11.typeOfObject(key)=="number")&&(key<0)&&("length" in _7c)){key=_7c.length+key;}if(typeof (_7c[key])=="undefined"){return null;}_7c=_7c[key];}return _7c;},_resolveEdit:function(_7e,_7f,_80){var _81=_7e;for(var _82=0;_82<_7f.length;_82++){var key=_7f[_82];if((_11.typeOfObject(key)=="number")&&(key<0)&&("length" in _81)){key=_81.length+key;}if(typeof (_81[key])=="undefined"){return;}if(_82<(_7f.length-1)){_81=_81[key];}else{_81[key]=_80;}}},_inferPropertyType:function(_83){var _84=dParser.valToType(_83);switch(_84){case "string":return "txt";case "number":return (Math.round(_83)==_83)?"int":"dec";case "date":return "dat";default:return "txt";}},_formatDate:function(_85,_86){_85=this._makeDate(_85);if(!_85){return null;}return _a.format(_85,this._getFormatOptions(_86));},_formatNumber:function(num,_87){num=this._makeNumber(num);if(!num){return null;}return _9.format(num,this._getFormatOptions(_87));},_formatPart:function(_88,_89){if(_89==null){var _8a=_11.typeOfObject(_88);switch(_8a){case "string":return ""+_88;case "date":return this._formatDate(_88,"dateTime");case "number":return this._formatNumber(_88,"decimal");case "object":return _e.stringify(_88);default:return ""+_88;}}switch(_89){case "txt":return ""+_88;case "dat":return this._formatDate(_88,"date");case "tim":return this._formatDate(_88,"time");case "dtm":return this._formatDate(_88,"dateTime");case "dec":return this._formatNumber(_88,"decimal");case "int":return this._formatNumber(_88,"integer");case "pct":return this._formatNumber(_88,"percent");case "cur":return this._formatNumber(_88,"currency");case "obj":return _e.stringify(_88);default:return ""+_88;}},_getData:function(){var _8b=this.data;if(_8b){return _8b;}if(this.propertyContainer==null){return null;}return this.propertyContainer.get("data");},_getEmptyFormat:function(){var _8c=this.emptyFormat;if(_8c!=null){return _8c;}if(this.propertyContainer!=null){var _8d=this.propertyContainer.get("resources");if((_8d)&&("emptyFormat" in _8d)){_8c=_8d["emptyFormat"];}}if(_8c!=null){return _8c;}_8c=_13.get("emptyFormat","idx/grid/PropertyFormatter");return _8c||"";},_makeDate:function(_8e){if(_11.typeOfObject(_8e)=="date"){return _8e;}return _11.parseObject(""+_8e,"date");},_makeNumber:function(_8f){if(_11.typeOfObject(_8f)=="number"){return _8f;}return _11.parseObject(""+_8f,"number");},_makeBoolean:function(_90){if(_11.typeOfObject(_90)=="boolean"){return _90;}return _11.parseObject(""+_90,"boolean");},_makeObject:function(_91){if(_11.typeOfObject(_91)=="object"){return _91;}return _e.parse(""+_91);},_getFormatOptions:function(_92){_92=_92+"FormatOptions";if(this[_92]){return this[_92];}var _93=null;if(this.propertyContainer){var _94=this.propertyContainer.get("resources");if(_94){_93=_94[_92];}}if(_93){return _93;}_93=_13.get(_92,"idx/grid/PropertyFormatter");return _93;},onChange:function(_95,_96){},onEditorChange:function(_97,_98,_99){},_setReadOnlyAttr:function(_9a){this.readOnly=_9a;if(this._editorsByName){for(var _9b in this._editorsByName){var _9c=this._editorsByName[_9b];if(!_9c){continue;}var _9d=_9c.propertyEditAdaptor;if(!_9d){continue;}_9d.setEditorReadOnly(_9c,_9a);}}if(!this._editController){return;}this._editController.set("readOnly",_9a);},_setDisabledAttr:function(_9e){this.disabled=_9e;if(this._editorsByName){for(var _9f in this._editorsByName){var _a0=this._editorsByName[_9f];if(!_a0){continue;}var _a1=_a0.propertyEditAdaptor;if(!_a1){continue;}_a1.setEditorDisabled(_a0,_9e);}}if(!this._editController){return;}this._editController.set("disabled",_9e);},_onSave:function(_a2){if(!this._editMode){return;}this._editMode=false;for(var _a3=0;_a3<this._editorsByOrder.length;_a3++){var _a4=this._editorsByOrder[_a3];if(!_a4){continue;}var _a5=_a4.propertyEditAdaptor;if(!_a5){continue;}var _a6=_a5.getPropertyName(_a4);if(!_12.nullTrim(_a6)){continue;}var _a7=_a5.getEditorValue(_a4);var _a8=_a5.isEditorCheckable(_a4);var _a9=_a5.isEditorChecked(_a4);if((_a7=="on"||_a7=="false"||_a7=="true"||_a7=="off")&&((_a9===true)||(_a9===false)||_a8)){_a7=_a9;}this.saveEditorValue(_a6,_a7);}for(var _a3=0;_a3<this._properties.length;_a3++){var _aa=this._properties[_a3];var _ab=_aa.propName;var _a4=this._editorsByName[_ab];if(!_a4){continue;}var _a5=_a4.propertyEditAdaptor;if(!_a5){continue;}if(_12.nullTrim(_a5.getPropertyName(_a4))){continue;}var _a7=_a5.getEditorValue(_a4);var _a8=_a5.isEditorCheckable(_a4);var _a9=_a5.isEditorChecked(_a4);if((_a7=="on"||_a7=="false"||_a7=="true"||_a7=="off")&&((_a9===true)||(_a9===false)||_a8)){_a7=_a9;}this.saveEditorValue(_ab,_a7);}this._reformat();_f.remove(this.domNode,this.baseClass+"EditMode");this.onChange(this._getData(),this);},_onCancel:function(_ac){if(!this._editMode){return;}this._editMode=false;_f.remove(this.domNode,this.baseClass+"EditMode");this._prepareEditors();if(this._editController){this._editController.set("readOnly",this.readOnly);}this.onEditCancel();},onEditCancel:function(){},onEditBegin:function(){},_prepareEditors:function(){for(var _ad=0;_ad<this._editorsByOrder.length;_ad++){var _ae=this._editorsByOrder[_ad];if(!_ae){continue;}var _af=_ae.propertyEditAdaptor;if(!_af){continue;}var _b0=_af.getPropertyName(_ae);if(!_12.nullTrim(_b0)){continue;}var _b1=this.prepareEditorValue(_b0);if((_b1==true)||(_b1==false)){var _b2=_af.isEditorCheckable(_ae);var _b3=_af.isEditorChecked(_ae);if((_b3==true)||(_b3==false)||_b2){_af.setEditorChecked(_ae,_b1);}}if(_af.isEditorResetable(_ae)){_af.resetEditor(_ae);}_af.setEditorValue(_ae,_b1);if(!_af.isEditorResetable(_ae)&&_af.isEditorValidating(_ae)){_af.validateEditor(_ae);}}for(var _ad=0;_ad<this._properties.length;_ad++){var _b4=this._properties[_ad];var _b5=_b4.propName;var _ae=this._editorsByName[_b5];if(!_ae){continue;}var _af=_ae.propertyEditAdaptor;if(!_af){continue;}if(_12.nullTrim(_af.getPropertyName(_ae))){continue;}var _b1=this.prepareEditorValue(_b5);if((_b1==true)||(_b1==false)){var _b2=_af.isEditorCheckable(_ae);var _b3=_af.isEditorChecked(_ae);if((_b3==true)||(_b3==false)||_b2){_af.setEditorChecked(_ae,_b1);}}if(_af.isEditorResetable(_ae)){_af.resetEditor(_ae);}if(_af.isEditorResizable(_ae)){_af.resizeEditor(_ae);}_af.setEditorValue(_ae,_b1);if(!_af.isEditorResetable(_ae)&&_af.isEditorValidating(_ae)){_af.validateEditor(_ae);}}},_onEdit:function(_b6){if(this._editMode){return;}if(this.getChildren().length==0){return;}this._editMode=true;_f.add(this.domNode,this.baseClass+"EditMode");this._prepareEditors();if((this._editController)&&(this._editorsByOrder.length>0)){var _b7=this._editorsByOrder[0];if("focus" in _b7&&_6.isFunction(_b7.focus)){_b7.focus();}}this.onEditorChange();this.onEditBegin();},focus:function(){if((this._editMode)&&(this._editorsByOrder.length>0)){var _b8=this._editorsByOrder[0];if("focus" in _b8&&_6.isFunction(_b8.focus)){_b8.focus();}else{this.focusNode.focus();}}else{this.focusNode.focus();}},prepareEditorValue:function(_b9){var _ba=this._getData();var val=null;if(this.toEditFunc){val=this.toEditFunc.call(this,_b9,_ba);}if(val){return val;}var _bb=this._propsByName[_b9];if(!_bb){return null;}return (_ba)?this._resolveValue(_ba,_bb.propParts):null;},saveEditorValue:function(_bc,_bd){var _be=this._getData();var _bf=null;var _c0={};if(!_be){return;}if(this.fromEditFunc){var _c1=this.fromEditFunc.call(this,_bc,_bd,_be);if(_c1!=null){for(var _c2 in _c1){_bf=this._propsByName[_c2];if(_bf){this._resolveEdit(_be,_bf.propParts,_c1[_c2]);}}return;}}_bf=this._propsByName[_bc];if(_bf){this._resolveEdit(_be,_bf.propParts,_bd);}},onRefresh:function(_c3,_c4,_c5){}});});