//>>built
define("idx/gridx/core/model/extensions/FormatSort",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/data/util/sorter","../_Extension"],function(_1,_2,_3,_4,_5){function _6(_7,_8,_9,_a){return function(_b,_c){return _a.getValue?_8*_9(_a.getValue(_b,_7),_a.getValue(_c,_7)):_8*_9(_b[_7],_c[_7]);};};function _d(_e,_f,_10,_11,_12,_13){var _14={};return function(_15,_16){var idA=_11.getIdentity(_15),idB=_11.getIdentity(_16);if(!_14[idA]){_14[idA]=_13(_12._itemToObject(_15));}if(!_14[idB]){_14[idB]=_13(_12._itemToObject(_16));}return _f*_10(_14[idA],_14[idB]);};};return _1(_5,{name:"formatSort",priority:50,constructor:function(_17){var t=this,c=t.cache=_17._cache;t.aspect(c,"onBeforeFetch","_onBeforeFetch");t.aspect(c,"onAfterFetch","_onAfterFetch");},_onBeforeFetch:function(req){var t=this,_18=t.model.store;t._oldCreateSortFunction=_4.createSortFunction;_4.createSortFunction=_3.hitch(t,t._createComparator);if(req.sort&&_3.isFunction(_18.put)){req.sort=t._createComparator(req.sort,_18);}},_onAfterFetch:function(){if(this._oldCreateSortFunction){_4.createSortFunction=this._oldCreateSortFunction;delete this._oldCreateSortFunction;}},_createComparator:function(_19,_1a){var _1b=[],c=this.cache,map=_1a.comparatorMap,bc=_4.basicComparator;_2.forEach(_19,function(_1c){var _1d=_1c.attribute,dir=_1c.descending?-1:1,_1e=bc,col=c.columns&&c.columns[_1c.colId];if(map){if(typeof _1d!=="string"&&_1d.toString){_1d=_1d.toString();}_1e=map[_1d]||bc;}if(col&&col.comparator){_1e=col.comparator;}var _1f=col&&col.sortFormatted&&col.formatter;_1b.push(_1f?_d(_1d,dir,_1e,_1a,c,_1f):_6(_1d,dir,_1e,_1a));});return function(_20,_21){var i,len,ret=0;for(i=0,len=_1b.length;!ret&&i<len;++i){ret=_1b[i](_20,_21);}return ret;};}});});