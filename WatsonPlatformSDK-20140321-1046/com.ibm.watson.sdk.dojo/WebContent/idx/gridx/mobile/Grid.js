//>>built
define("idx/gridx/mobile/Grid",["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/aspect","dojo/string","dojo/dom-class","dojox/mobile/_StoreMixin","dojox/mobile/Pane","dojox/mobile/ScrollablePane","dojo/i18n!./nls/common","dojo/_base/Deferred"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d){_1.experimental("gridx/mobile/Grid");return _2("gridx.mobile.Grid",[_a,_9],{autoHeight:true,showHeader:false,vScroller:true,hScroller:false,columns:null,setColumns:function(_e){this.columns=_e;this.refresh();},buildGrid:function(){if(this.columns){this._buildHeader();}if(this.store){this._buildBody();}this.resize();},_buildHeader:function(){if(!this.showHeader){this.headerNode.style.display="none";return;}else{this.headerNode.style.display="block";}var _f=["<div class=\"mobileGridxHeaderRow\"><table><tr>"];_4.forEach(this.columns,function(col){_f.push("<th class=\"mobileGridxHeaderCell ",col.cssClass||"",col.align?" align-"+col.align:"",col.width?"\" style=\"width:"+col.width+";\"":"",">",col.title,"</th>");});_f.push("</tr></table></div>");this.headerNode.innerHTML=_f.join("");},_buildBody:function(_10){if(_10&&_10.length){var arr=[];_4.forEach(_10,function(_11,i){arr.push(this._createRow(_11,i%2==1));},this);this.bodyPane.containerNode.innerHTML=arr.join("");}else{this.bodyPane.containerNode.innerHTML="<div class=\"mobileGridxNoDataNode\">"+_c.noDataMsg+"</div>";}},_createRow:function(_12){var _13=this.store.getIdentity(_12);var arr=["<div class=\"mobileGridxRow\"",_13?" rowId=\""+_13+"\"":"","><table><tr>"];_4.forEach(this.columns,function(col){var _14=this._getCellContent(col,_12);arr.push("<td class=\"mobileGridxCell ",((col.cssClass||col.align)?((col.cssClass||"")+(col.align?" align-"+col.align:"")):""),"\"",(col.width?" style=\"width:"+col.width+";\"":""),">",_14,"</td>");},this);arr.push("</tr></table></div>");return arr.join("");},_getCellContent:function(col,_15){var f=col.formatter;if(col.template){return _7.substitute(col.template,_15);}else{return f?f(_15,col):_15[col.field];}},buildRendering:function(){this.inherited(arguments);_8.add(this.domNode,"mobileGridx");this.domNode.innerHTML="<div class=\"mobileGridxHeader\"></div><div class=\"mobileGridxBody\"></div><div class=\"mobileGridxFooter\"></div>";this.headerNode=this.domNode.childNodes[0];this.bodyNode=this.domNode.childNodes[1];this.footerNode=this.domNode.childNodes[2];this.containerNode=this.bodyNode;var _16=(this.vScroller?"v":"")+(this.hScroller?"h":"");if(!_16){_16="v";}this.bodyPane=new _b({scrollDir:_16,scrollType:1},this.bodyNode);this.bodyPane._useTopLeft=false;if(this.showHeader){var h=this.headerNode;this.connect(this.bodyPane,"scrollTo",function(to){if((typeof to.x)!="number"){return;}h.firstChild.style.webkitTransform=this.bodyPane.makeTranslateStr({x:to.x});});this.connect(this.bodyPane,"slideTo",function(to,_17,_18){this.bodyPane._runSlideAnimation({x:this.bodyPane.getPos().x},{x:to.x},_17,_18,h.firstChild,2);});this.connect(this.bodyPane,"stopAnimation",function(){_8.remove(h.firstChild,"mblScrollableScrollTo2");});}},resize:function(){this.inherited(arguments);var h=this.domNode.offsetHeight;if(this.autoHeight){this.domNode.style.height="auto";var n=this.domNode,p=n.parentNode;h=this.bodyPane.getScreenSize().h;_4.forEach(p.childNodes,function(_19){if(_19==n){return;}h-=(_19.offsetHeight||0);});}h=h-this.headerNode.offsetHeight-this.footerNode.offsetHeight;this.bodyNode.style.height=h+"px";},startup:function(){this.bodyPane.startup();this.inherited(arguments);this.refresh();this.resize();},onComplete:function(_1a){this._buildBody(_1a);},onError:function(_1b){},onUpdate:function(_1c,_1d){_5.place(this._createRow(_1c),this.bodyNode.firstChild,_1d);},onDelete:function(_1e,_1f){_5.destroy(this.bodyNode.firstChild.childNodes[_1f]);},refresh:function(){this._buildHeader();if(!this.store){return null;}var _20=this;var _21=this.store.query(this.query,this.queryOptions);_d.when(_21,function(_22){if(_22.items){_22=_22.items;}if(_21.observe){_21.observe(function(_23,_24,_25){if(_24>-1){_20.onDelete(_23,_24);}if(_25>-1){_20.onUpdate(_23,_25);}},true);}_20.onComplete(_22);},function(_26){_20.onError(_26);});this.resize();return _21;}});});