//>>built
define("idx/gridx/mobile/PullRefresh",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/aspect","dojo/dom-construct","dojo/dom-class","dojo/query","dojo/i18n!./nls/PullRefresh"],function(_1,_2,_3,_4,_5,_6,_7,_8){return _1(null,{readyToRefresh:false,state:"normal",triggerHeight:50,lastId:null,buildRendering:function(){this.inherited(arguments);var _9=this;_4.before(this.bodyPane,"slideTo",function(to,_a,_b){if((typeof to.y)!="number"){return;}if(to.y==0&&_9.state!="normal"){to.y=_9.triggerHeight;if(_9.state=="ready"){_9.loadNew();_9._setPullRefreshState("loading");}}});this.connect(this.bodyPane,"scrollTo",function(to){if((typeof to.y)!="number"){return;}var _c=_9.pullRefreshWrapper;if(to.y==0){if(_9.state=="ready"){}}else{if(to.y>_9.triggerHeight){if(_9.state=="normal"){_9._setPullRefreshState("ready");}}else{if(_9.state=="ready"){_9._setPullRefreshState("normal");}}}});},loadNew:function(){var q=_2.mixin({"lastId":this.lastId},this.query);this.store.query(q,this.queryOptions).then(_2.hitch(this,"_loadNewComplete"),_2.hitch(this,"onError"));},_loadNewComplete:function(_d){var _e=_d.items||_d,_f=[];if(_e.length){var _10=_7(">.mobileGridxRow",this.bodyPane.containerNode);this.lastId=_e[0][this.store.idProperty];_3.forEach(_e,function(_11){_f.push(this._createRow(_11));},this);_5.place(_f.join(""),this.pullRefreshWrapper,"after");}this._setPullRefreshState("normal");this.bodyPane.slideTo({y:0});},_setPullRefreshState:function(_12){var _13=this.pullRefreshWrapper,_14=_13.lastChild;_6.remove(_13,"releaseToRefresh");_6.remove(_13,"inLoading");this.state=_12;switch(_12){case "normal":_14.innerHTML=_8.pullToRefresh;break;case "ready":_14.innerHTML=_8.releaseToRefresh;_6.add(_13,"releaseToRefresh");break;case "loading":_14.innerHTML=_8.waitForLoading;_6.add(_13,"inLoading");break;default:break;}},_buildBody:function(){this.inherited(arguments);this.pullRefreshWrapper=_5.create("div",{className:"mobileGridxPullRefreshWrapper"},this.bodyPane.containerNode,"first");this.pullRefreshWrapper.innerHTML="<img src=\""+this._blankGif+"\"/><span class=\"mobileGridxPullRefreshLabel\">"+_8.pullToRefresh+"</span>";}});});