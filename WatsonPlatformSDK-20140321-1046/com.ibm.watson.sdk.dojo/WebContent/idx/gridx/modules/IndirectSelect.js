//>>built
define("idx/gridx/modules/IndirectSelect",["dojo/_base/declare","dojo/_base/array","dojo/_base/event","dojo/_base/query","dojo/_base/lang","dojo/dom-class","dojo/_base/Deferred","dojo/keys","../core/_Module","../core/util","./RowHeader"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){return _1(_9,{name:"indirectSelect",required:["rowHeader","selectRow"],preload:function(){var t=this,g=t.grid,_b=g.focus,sr=g.select.row,_c=g.rowHeader;_c.cellProvider=_5.hitch(t,t._createSelector);t.batchConnect([sr,"onHighlightChange","_onHighlightChange"],[sr,"clear","_onClear"],[sr,"onSelectionChange","_onSelectionChange"],[g,"onRowMouseOver","_onMouseOver"],[g,"onRowMouseOut","_onMouseOut"],[g,"onRowKeyDown","_onKeyDown"],[g,"onHeaderKeyDown","_onKeyDown"],_b&&[_b,"onFocusArea",function(_d){if(_d=="rowHeader"){t._onMouseOver();}}],_b&&[_b,"onBlurArea",function(_e){if(_e=="rowHeader"){t._onMouseOut();}}]);if(sr.selectByIndex&&t.arg("all")){t._allSelected={};_c.headerProvider=_5.hitch(t,t._createSelectAllBox);_c.loaded.then(function(){if(_b){t._initFocus();}t.connect(g,"onRowHeaderHeaderMouseDown","_onSelectAll");});}},all:true,_createSelector:function(_f){var _10=_f.node(),_11=_10&&_6.contains(_10,"gridxRowSelected"),_12=_10&&_6.contains(_10,"gridxRowPartialSelected");return this._createCheckBox(_11,_12);},_createCheckBox:function(_13,_14){var _15=this._getDijitClass();return ["<span role=\"",this._isSingle()?"radio":"checkbox","\" class=\"gridxIndirectSelectionCheckBox dijitReset dijitInline ",_15," ",_13?_15+"Checked":"",_14?_15+"Partial":"","\" aria-checked=\"",_13?"true":_14?"mixed":"false","\"><span class=\"gridxIndirectSelectionCheckBoxInner\">",_13?"&#10003;":_14?"&#9646;":"&#9744;","</span></span>"].join("");},_createSelectAllBox:function(){return this._createCheckBox(this._allSelected[this._getPageId()]);},_getPageId:function(){return this.grid.body.rootStart+","+this.grid.body.rootCount;},_onClear:function(){var cls=this._getDijitClass()+"Checked";_4("."+cls,this.grid.rowHeader.bodyNode).removeClass(cls);},_onHighlightChange:function(_16,_17){var _18=_4("[visualindex=\""+_16.row+"\"].gridxRowHeaderRow .gridxIndirectSelectionCheckBox",this.grid.rowHeader.bodyNode)[0];if(_18){var _19=this._getDijitClass(),_1a=_17=="mixed",_1b=_17&&!_1a;_6.toggle(_18,_19+"Checked",_1b);_6.toggle(_18,_19+"Partial",_1a);_18.setAttribute("aria-checked",_1b?"true":_1a?"mixed":"false");_18.firstChild.innerHTML=_1b?"&#10003;":_1a?"&#9646;":"&#9744;";}},_onMouseOver:function(){var sr=this.grid.select.row;if(!sr.holdingCtrl){this._holdingCtrl=false;sr.holdingCtrl=true;}},_onMouseOut:function(){if(this.hasOwnProperty("_holdingCtrl")){this.grid.select.row.holdingCtrl=false;delete this._holdingCtrl;}},_getDijitClass:function(){return this._isSingle()?"dijitRadio":"dijitCheckBox";},_isSingle:function(){var _1c=this.grid.select.row;return _1c.hasOwnProperty("multiple")&&!_1c.arg("multiple");},_onSelectAll:function(){var t=this,g=t.grid,_1d=g.body;g.select.row[t._allSelected[t._getPageId()]?"deselectByIndex":"selectByIndex"]([0,_1d.visualCount-1]);},_onSelectionChange:function(_1e){var t=this,d,_1f,_20=t.grid.body,_21=t.model,_22=_20.rootStart,_23=_20.rootCount;var _24=_2.filter(_1e,function(id){return !_21.treePath(id).pop();});if(_23===_21.size()){_1f=_23==_24.length;}else{d=new _7();_21.when({start:_22,count:_23},function(){var _25=_2.filter(_2.map(_24,function(id){return _21.idToIndex(id);}),function(_26){return _26>=_22&&_26<_22+_23;});_1f=_23==_25.length;d.callback();});}_7.when(d,function(){if(t.arg("all")){t._allSelected[t._getPageId()]=_1f;var _27=t.grid.rowHeader.headerCellNode.firstChild;_6.toggle(_27,t._getDijitClass()+"Checked",_1f);_27.setAttribute("aria-checked",_1f?"true":"false");}});},_initFocus:function(){var g=this.grid,_28=g.rowHeader,_29=_28.headerCellNode,_2a=function(evt){g.focus.stopEvent(evt);_6.add(_29,"gridxHeaderCellFocus");_29.focus();return true;},_2b=function(){_6.remove(_29,"gridxHeaderCellFocus");return true;};g.focus.registerArea({name:"selectAll",priority:-0.1,focusNode:_28.headerNode,doFocus:_2a,doBlur:_2b,onFocus:_2a,onBlur:_2b});},_onKeyDown:function(evt){if(evt.keyCode==65&&evt.ctrlKey&&!evt.shiftKey){if(!this._allSelected[this._getPageId()]){this._onSelectAll();}_3.stop(evt);}}});});