//>>built
define("idx/gridx/modules/NavigableCell",["dojo/_base/declare","dojo/_base/event","dojo/_base/sniff","dojo/dom-class","dojo/keys","dijit/a11y","../core/_Module"],function(_1,_2,_3,_4,_5,_6,_7){return _7.register(_1(_7,{name:"navigableCell",preload:function(){var t=this,_8=t.grid.focus;_8.registerArea({name:"navigablecell",priority:1,scope:t,doFocus:t._doFocus,doBlur:t._doBlur,onFocus:t._onFocus,onBlur:t._endNavigate,connects:[t.connect(t.grid,"onCellKeyDown","_onKey")]});},_doFocus:function(_9,_a){if(this._navigating){var _b=this._navElems,_c=function(){var _d=_a<0?(_b.highest||_b.last):(_b.lowest||_b.first);if(_d){_d.focus();}};if(_3("webkit")){_c();}else{setTimeout(_c,5);}return true;}return false;},_doBlur:function(_e,_f){if(_e){var t=this,m=t.model,g=t.grid,_10=g.body,_11=t._navElems,_12=_11.lowest||_11.first,_13=_11.last||_11.highest||_12,_14=_3("ie")?_e.srcElement:_e.target;if(_14==(_f>0?_13:_12)){_2.stop(_e);m.when({id:t._focusRowId},function(){var _15=_10.getRowInfo({parentId:m.treePath(t._focusRowId).pop(),rowIndex:m.idToIndex(t._focusRowId)}).visualIndex,_16=g._columnsById[t._focusColId].index,dir=_f>0?1:-1,_17=function(r,c){return t._isNavigable(g._columns[c].id);};_10._nextCell(_15,_16,dir,_17).then(function(obj){t._focusColId=g._columns[obj.c].id;var _18=_10.getRowInfo({visualIndex:obj.r});t._focusRowId=m.indexToId(_18.rowIndex,_18.parentId);_10._focusCellCol=obj.c;_10._focusCellRow=obj.r;t._beginNavigate(t._focusRowId,t._focusColId);t._doFocus(null,_f);});});}return false;}else{this._navigating=false;return true;}},_isNavigable:function(_19){var col=this.grid._columnsById[_19];return col&&(col.navigable||col.navigable===undefined)&&col.decorator;},_beginNavigate:function(_1a,_1b){var t=this;if(t._isNavigable(_1b)){t._navigating=true;t._focusColId=_1b;t._focusRowId=_1a;t._navElems=_6._getTabNavigable(t.grid.body.getCellNode({rowId:_1a,colId:_1b}));return true;}return false;},_endNavigate:function(){this._navigating=false;},_onFocus:function(evt){var _1c=evt.target,dn=this.grid.domNode;while(_1c&&_1c!==dn&&!_4.contains(_1c,"gridxCell")){_1c=_1c.parentNode;}if(_1c&&_1c!==dn){var _1d=_1c,_1e=_1c.getAttribute("colid");while(_1c&&!_4.contains(_1c,"gridxRow")){_1c=_1c.parentNode;}if(_1c){var _1f=_1c.getAttribute("rowid");return _1d!=evt.target&&this._beginNavigate(_1f,_1e);}}return false;},_onKey:function(e){var t=this,_20=t.grid.focus;if(e.keyCode==_5.F2&&!t._navigating&&_20.currentArea()=="body"){if(t._beginNavigate(e.rowId,e.columnId)){_2.stop(e);_20.focusArea("navigablecell");}}else{if(e.keyCode==_5.ESCAPE&&t._navigating&&_20.currentArea()=="navigablecell"){t._navigating=false;_20.focusArea("body");}}}}));});