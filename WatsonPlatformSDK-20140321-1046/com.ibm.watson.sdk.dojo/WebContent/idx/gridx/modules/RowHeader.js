//>>built
define("idx/gridx/modules/RowHeader",["dojo/_base/declare","dojo/_base/query","dojo/_base/lang","dojo/_base/sniff","dojo/aspect","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojo/dom-geometry","dojo/keys","../core/_Module","../core/util"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){return _1(_b,{name:"rowHeader",getAPIPath:function(){return {rowHeader:this};},constructor:function(){this.headerNode=_6.create("div",{"class":"gridxRowHeaderHeader",role:"row",innerHTML:["<table role=\"presentation\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"width: ",this.arg("width"),";\"><tr><th class=\"gridxRowHeaderHeaderCell\" role=\"rowheader\" tabindex=\"-1\"></th></tr></table>"].join("")});this.bodyNode=_6.create("div",{"class":"gridxRowHeaderBody"});},destroy:function(){this.inherited(arguments);this._b.remove();_6.destroy(this.headerNode);_6.destroy(this.bodyNode);},preload:function(){var t=this,_d=t.headerNode,_e=t.bodyNode,g=t.grid,_f=g.body,w=t.arg("width");g._initEvents(["RowHeaderHeader","RowHeaderCell"],g._eventNames);g.header.domNode.appendChild(_d);_d.style.width=w;t.headerCellNode=_2("th",_d)[0];g._connectEvents(_d,"_onHeaderMouseEvent",t);g.mainNode.appendChild(_e);_e.style.width=w;g.hLayout.register(null,_e);t.batchConnect([_f,"onRender","_onRendered"],[_f,"onAfterRow","_onAfterRow"],[_f,"onAfterCell","_onAfterCell"],[_f,"onUnrender","_onUnrender"],[g.bodyNode,"onscroll","_onScroll"],[g,"onRowMouseOver","_onRowMouseOver"],[g,"onRowMouseOut","_onRowMouseOver"],[g,"_onResizeEnd","_onResize"],g.columnWidth&&[g.columnWidth,"onUpdate","_onResize"],g.columnResizer&&[g.columnResizer,"onResize","_onResize"],[g,"onRowHeaderCellMouseOver","_onCellMouseOver"],[g,"onRowHeaderCellMouseOut","_onCellMouseOver"]);t._b=_5.before(_f,"renderRows",_3.hitch(t,t._onRenderRows),true);_5.before(_f,"_onDelete",_3.hitch(t,t._onDelete),true);g._connectEvents(_e,"_onBodyMouseEvent",t);t._initFocus();},load:function(_10,_11){var t=this,g=t.grid,bn=t.bodyNode;_11.then(function(){var w=bn.offsetWidth||_8.get(bn,"width"),ltr=g.isLeftToRight(),_12=_9.getBorderExtents(g.mainNode);bn.style[ltr?"left":"right"]=-(w+(ltr?_12.l:_12.r))+"px";t.loaded.callback();});},width:"20px",onMoveToRowHeaderCell:function(){},_onRenderRows:function(_13,_14,_15){var nd=this.bodyNode;if(_14>0){var str=this._buildRows(_13,_14);if(_15=="top"){_6.place(str,nd,"first");}else{if(_15=="bottom"){_6.place(str,nd,"last");}else{nd.innerHTML=str;nd.scrollTop=0;}}}else{if(_15!="top"&&_15!="bottom"){nd.innerHTML="";}}},_onAfterRow:function(row){var t=this,_16=row.visualIndex(),n=_2("[visualindex=\""+_16+"\"].gridxRowHeaderRow",t.bodyNode)[0],bn=_2("[visualindex=\""+_16+"\"].gridxRow .gridxRowTable",t.grid.bodyNode)[0],nt=n.firstChild,cp=t.arg("cellProvider");n.setAttribute("rowid",row.id);n.setAttribute("rowindex",row.index());n.setAttribute("parentid",t.model.treePath(row.id).pop()||"");if(cp){nt.firstChild.firstChild.firstChild.innerHTML=cp.call(t,row);}t._syncRowHeight(nt,bn);},_onAfterCell:function(_17){var t=this,_18=_17.row.visualIndex(),n=_2("[visualindex=\""+_18+"\"].gridxRowHeaderRow",t.bodyNode)[0],bn=_2("[visualindex=\""+_18+"\"].gridxRow .gridxRowTable",t.grid.bodyNode)[0];t._syncRowHeight(n.firstChild,bn);},_syncRowHeight:function(_19,_1a){var t=this;if(t._isCollapse===undefined){var _1b=_2(".gridxCell",t.grid.header.innerNode)[0];t._isCollapse=_1b&&_8.get(_1b,"borderCollapse")=="collapse";}function _1c(){return _4("ie")<=8||t._isCollapse?_1a.offsetHeight+"px":_8.getComputedStyle(_1a).height;};_19.style.height=_1c();setTimeout(function(){_19.style.height=_1c();},0);},_onRendered:function(_1d,_1e){var t=this,hp=t.arg("headerProvider");if(hp){t.headerCellNode.innerHTML=hp();}t._onScroll();},_onDelete:function(id){var _1f=this.model.isId(id)&&_2("[rowid=\""+id+"\"].gridxRowHeaderRow",this.bodyNode);if(_1f&&_1f.length){var _20=_1f[_1f.length-1],pid=_20.getAttribute("parentid"),_21={},_22=1;_21[id]=1;for(sn=_20.nextSibling;sn&&_21[sn.getAttribute("parentid")];sn=sn.nextSibling){rid=sn.getAttribute("rowid");_22++;_21[rid]=1;}for(;sn;sn=sn.nextSibling){if(sn.getAttribute("parentid")==pid){sn.setAttribute("rowindex",parseInt(sn.getAttribute("rowindex"),10)-1);}var _23=parseInt(sn.getAttribute("visualindex"),10);sn.setAttribute("visualindex",_23-_22);}}},_onUnrender:function(id){var _24=this.model.isId(id)&&_2("[rowid=\""+id+"\"].gridxRowHeaderRow",this.bodyNode);if(_24&&_24.length){_6.destroy(_24[_24.length-1]);}},_onScroll:function(){this.bodyNode.scrollTop=this.grid.bodyNode.scrollTop;},_onResize:function(){var ie=_4("ie");for(var brn=this.grid.bodyNode.firstChild,n=this.bodyNode.firstChild;brn&&n;brn=brn.nextSibling,n=n.nextSibling){n.firstChild.style.height=ie>8?_8.getComputedStyle(brn.firstChild).height:brn.firstChild.offsetHeight+"px";}var t=this,g=t.grid,bn=t.bodyNode,w=bn.offsetWidth||_8.get(bn,"width"),ltr=g.isLeftToRight(),_25=_9.getBorderExtents(g.mainNode);bn.style[ltr?"left":"right"]=-(w+(ltr?_25.l:_25.r))+"px";},_buildRows:function(_26,_27){var sb=[];for(var i=0;i<_27;++i){sb.push("<div class=\"gridxRowHeaderRow\" role=\"row\" visualindex=\"",_26+i,"\"><table role=\"presentation\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"height: 24px;\"><tr><td class=\"gridxRowHeaderCell\" role=\"rowheader\" tabindex=\"-1\"></td></tr></table></div>");}return sb.join("");},_onHeaderMouseEvent:function(_28,e){var g=this.grid,_29="onRowHeaderHeader"+_28;if(g._isConnected(_29)){g[_29](e);}},_onBodyMouseEvent:function(_2a,e){var g=this.grid,_2b="onRowHeaderCell"+_2a,_2c="onRow"+_2a,_2d=g._isConnected(_2b),_2e=g._isConnected(_2c);if(_2d||_2e){this._decorateBodyEvent(e);if(e.rowIndex>=0){if(e.isRowHeader&&_2d){g[_2b](e);}if(_2e){g[_2c](e);}}}},_decorateBodyEvent:function(e){var _2f=e.target||e.originalTarget;while(_2f&&_2f!=this.bodyNode){if(_7.contains(_2f,"gridxRowHeaderCell")){e.isRowHeader=true;e.rowHeaderCellNode=_2f;}else{if(_2f.tagName.toLowerCase()==="div"&&_7.contains(_2f,"gridxRowHeaderRow")){e.rowId=_2f.getAttribute("rowid");e.parentId=_2f.getAttribute("parentid");e.rowIndex=parseInt(_2f.getAttribute("rowindex"),10);e.visualIndex=parseInt(_2f.getAttribute("visualindex"),10);return;}}_2f=_2f.parentNode;}},_onRowMouseOver:function(e){var _30=_2("> [rowid=\""+e.rowId+"\"].gridxRowHeaderRow",this.bodyNode)[0];if(_30){_7.toggle(_30,"gridxRowOver",e.type.toLowerCase()=="mouseover");}},_onCellMouseOver:function(e){var _31=_2("> [rowid=\""+e.rowId+"\"].gridxRowHeaderRow .gridxRowHeaderCell",this.bodyNode)[0];if(_31){_7.toggle(_31,"gridxRowHeaderCellOver",e.type.toLowerCase()=="mouseover");}},_initFocus:function(){var t=this,_32=t.grid.focus;if(_32){_32.registerArea({name:"rowHeader",priority:0.9,focusNode:t.bodyNode,scope:t,doFocus:t._doFocus,onFocus:t._onFocus,doBlur:t._blur,onBlur:t._blur,connects:[t.connect(t.bodyNode,"onkeydown","_onKeyDown")]});}},_doFocus:function(evt){if(this._focusRow(this.grid.body._focusCellRow)){this.grid.focus.stopEvent(evt);return true;}},_onFocus:function(evt){var t=this,_33=evt.target;while(_33!=t.bodyNode){if(_7.contains(_33,"gridxRowHeaderRow")){var r=t.grid.body._focusCellRow=parseInt(_33.getAttribute("visualindex"),10);t._focusRow(r);return true;}_33=_33.parentNode;}},_focusRow:function(_34){var t=this,_35=_2("[visualindex=\""+_34+"\"] .gridxRowHeaderCell",t.bodyNode)[0];t._blur();_35=_35||t.bodyNode.firstChild;if(_35){_7.add(_35,"gridxCellFocus");_35.focus();}return _35;},_blur:function(){_2(".gridxCellFocus",this.bodyNode).forEach(function(_36){_7.remove(_36,"gridxCellFocus");});return true;},_onKeyDown:function(evt){var t=this,g=t.grid;if(g.focus.currentArea()=="rowHeader"&&evt.keyCode==_a.UP_ARROW||evt.keyCode==_a.DOWN_ARROW){g.focus.stopEvent(evt);var _37=evt.keyCode==_a.UP_ARROW?-1:1,_38=g.body,r=_38._focusCellRow+_37;_38._focusCellRow=r=r<0?0:(r>=_38.visualCount?_38.visualCount-1:r);g.vScroller.scrollToRow(r).then(function(){t._focusRow(r);t.onMoveToRowHeaderCell(r,evt);});}}});});