//>>built
define("idx/gridx/support/exporter/exporter",["dojo/_base/lang","dojo/_base/Deferred","dojo/_base/array"],function(_1,_2,_3){function _4(_5,_6,_7,_8){return !_5[_6]||false!==_5[_6](_7||_8,_8);};function _9(_a,_b,_c){var _d=[],i,_e=0,_f=0,ps=_a.progressStep;if(typeof _a.start=="number"&&_a.start>=0){_e=_a.start;}if(typeof _a.count=="number"&&_a.count>0){_f=_e+_a.count;}_f=_f||_c;if(_b){_b=_3.filter(_b,function(idx){return idx>=_e&&idx<_f;});if(_b.length&&(!ps||_b.length<=ps)){_d.push(_b);}else{for(i=0;i<_b.length;i+=ps){_d.push(_b.slice(i,i+ps));}}}else{var _10=_f-_e;if(!ps||_10<=ps){_d.push({start:_e,count:_10});}else{for(i=_e;i<_f;i+=ps){_d.push({start:i,count:i+ps<_f?ps:_f-i});}}}_d.p=0;return _d;};function _11(req,_12){return _1.isArray(req)?{p:0,row:_12.row(req[0])}:{p:req.start,row:_12.row(req.start)};};function _13(req,_14,_15){var p=_15.p+1,_16=_1.isArray(req);return p<(_16?req.length:req.start+req.count)?{p:p,row:_14.row(_16?req[p]:p)}:null;};function _17(_18,_19){var fs=_18.formatters,cid=_19.column.id;if(fs&&_1.isFunction(fs[cid])){return fs[cid](_19);}else{if(_18.useStoreData){return _19.rawData()||"";}}return _19.data()||"";};function _1a(_1b,_1c,_1d,_1e,_1f,d,_20){var f=_1f.filter,_21=_1e.columnIds,req=_20[_20.p++],_22=_1.hitch(d,d.errback),_23=function(){_1c.progress(_20.p/_20.length);_1b.when(req,function(){for(var r=_11(req,_1b);r&&r.row;r=_13(req,_1b,r)){_1e.row=r.row;if((!f||f(r.row))&&_4(_1d,"beforeRow",_1e,_1f)){for(var i=0;i<_21.length;++i){var col=_1b.column(_21[i],1),_24=_1e.cell=_1b.cell(r.row,col);_1e.column=col;_1e.data=_17(_1f,_24);_4(_1d,"handleCell",_1e,_1f);}_4(_1d,"afterRow",_1e,_1f);}}}).then(function(){_1a(_1b,_1c,_1d,_1e,_1f,d,_20);},_22);};if(req){if(_20.length>1){setTimeout(_23,10);}else{_23();}}else{d.callback();}};function _25(_26,_27){var _28=_26._columnsById,s=_26.select,sc=s&&s.column,_29;if(_1.isArrayLike(_27.columns)&&_27.columns.length){_29=_3.filter(_27.columns,function(cid){return _28[cid];});_29.sort(function(a,b){return _28[a].index-_28[b].index;});}else{_29=_3.map(_26._columns,function(c){return c.id;});}return _29;};function _2a(_2b,_2c,_2d){var d=new _2(),_2e=_2b.model,_2f=_25(_2b,_2d),s=_2b.select,sr=s&&s.row,sc=s&&s.column,_30,_31,_32={grid:_2b,columnIds:_2f},_33=function(){_4(_2c,"afterBody",_32,_2d);d.callback(_2c.getResult());},_34=_1.hitch(d,d.errback);try{_4(_2c,"initialize",_32,_2d);if(!_2d.omitHeader&&_4(_2c,"beforeHeader",_32,_2d)){_3.forEach(_2f,function(cid){_32.column=_2b.column(cid,1);_4(_2c,"handleHeaderCell",_32,_2d);});_4(_2c,"afterHeader",_32,_2d);}if(_4(_2c,"beforeBody",_32,_2d)){if(_2d.selectedOnly&&sr&&(!sc||!sc.getSelected().length)){_30=_2e.when().then(function(){_31=sr.getSelected();},_34);}_2.when(_30,function(){var _35,_36=_31&&_2e.when({id:_31},function(){_35=_3.map(_31,function(id){return _2e.idToIndex(id);});_35.sort(function(a,b){return a-b;});},_34);_2.when(_36,function(){var dd=new _2(),_37=_2e.size();_1a(_2b,d,_2c,_32,_2d,dd,_9(_2d,_35,_37));dd.then(_33,_34);},_34);},_34);}else{d.callback(_2c.getResult());}}catch(e){_34(e);}return d;};return _2a;});