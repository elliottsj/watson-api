//>>built
define("idx/layout/MoveableTabContainer",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/window","dojo/_base/html","dojo/_base/event","dojo/_base/connect","dojo/keys","dojo/dnd/Moveable","dojo/touch","dijit/registry","dijit/layout/TabContainer","dijit/layout/TabController","dijit/layout/ScrollingTabController","dijit/layout/ContentPane"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f){var _10=_1("idx.layout.MoveableTabContainer",[_c],{controllerWidget:"idx.layout.MoveableTabController"});var _11=_1("idx.layout.MoveableTabController",[_e],{buttonWidget:"idx.layout.MoveableTabButton",_movingTab:false,_mock:null,startup:function(){this.inherited(arguments);this.subscribe(this.id+"/idx/tab/move/start","_onMoveStart");this.subscribe(this.id+"/idx/tab/move/end","_onMoveEnd");this.subscribe(this.id+"/idx/tab/move","_onMove");this.connect(this._rightBtn.domNode,"onmouseover","_onRightButtonMouseOver");this.connect(this._leftBtn.domNode,"onmouseover","_onLeftButtonMouseOver");this.connect(this._rightBtn.domNode,"onmouseout","_onScrollMouseOut");this.connect(this._leftBtn.domNode,"onmouseout","_onScrollMouseOut");this._indicator=_5.create("div",{"class":"idxMoveableTabIndicator"},this.containerNode);},onAddChild:function(_12,_13){this.inherited(arguments);var _14=this.pane2button[_12.id];if(_14){_14.page=_12;_14.tabTopicId=this.id;}},onRemoveChild:function(_15){this.inherited(arguments);this._hideIndicator();},_onMoveStart:function(msg){var _16=_b.byId(this.containerId);_16.selectChild(msg.content);this._computeBounds();var loc={x:msg.event.clientX,y:msg.event.clientY};var _17=this.getChildren();this._movingTab=true;this._tabIndex=_3.indexOf(_17,msg.target);},onkeypress:function(evt){var _18=evt.ctrlKey||evt.metaKey;var key=evt.keyCode;if(_18){var _19=_b.byId(this.containerId);var _1a=_19.selectedChildWidget;var _1b=_19.getChildren();var _1c=_3.indexOf(_1b,_1a);var dir=0;if(key===_8.RIGHT_ARROW){dir=(this.isLeftToRight()?1:-1);}else{if(key===_8.LEFT_ARROW){dir=(this.isLeftToRight()?-1:1);}else{this.inherited(arguments);}}if(dir>0){if(_1c<_1b.length-1){_6.stop(evt);_19.removeChild(_1a);_19.addChild(_1a,_1c+1);_19.selectChild(_1a);this.pane2button[_1a.id].focus();}}else{if(dir<0){if(_1c>0){_6.stop(evt);_19.removeChild(_1a);_19.addChild(_1a,_1c-1);_19.selectChild(_1a);this.pane2button[_1a.id].focus();}}}}else{this.inherited(arguments);}},_onMove:function(msg){var pos=_5.position(this.containerNode);var loc={x:msg.event.clientX-pos.x,y:msg.event.clientY-pos.y};var val=(this.tabPosition.indexOf("h")>-1?loc.y:loc.x);this._dragOut=!this._locationCheck(val,msg.event);},_onMoveEnd:function(msg){this._movingTab=false;this._repositionTab(this._insertLoc,msg.target);this._hideIndicator();},_onRightButtonMouseOver:function(){if(this._movingTab){this._rightHover=true;this._slide(1,1);}},_onLeftButtonMouseOver:function(){if(this._movingTab){this._leftHover=true;this._slide(-1,1);}},_onScrollMouseOut:function(){this._leftHover=false;this._rightHover=false;},_slide:function(dir,num){var w=_5.marginBox(this.getChildren()[0].domNode).w;var d=w*num*dir;var amt=this._getScroll()+d;this._setButtonClass(amt);var _1d=this.createSmoothScroll(amt);_1d.onEnd=_2.hitch(this,"_keepScrolling");_1d.play();},_keepScrolling:function(){var _1e=_2.hitch(this,function(){if(this._rightHover){this._slide(1,1);}else{if(this._leftHover){this._slide(-1,1);}}});setTimeout(_1e,0);},_repositionTab:function(loc,tab){if(!tab||!tab.page){return;}if(this._tabIndex<loc){loc--;}var _1f=_b.byId(this.containerId);try{_1f.removeChild(tab.page);if(this._mock){_1f.removeChild(this._mock);}}catch(e){}_1f.addChild(tab.page,loc);_1f.selectChild(tab.page);},_containsCursor:function(evt){var pos=_5.position(this.domNode);var l=pos.x,t=pos.y,r=l+pos.w,b=t+pos.h;var x=evt.clientX;var y=evt.clientY;if(x>l-20&&x<r+20&&y>t-20&&y<b+20){return true;}else{return false;}},_locationCheck:function(val,evt){if(evt&&!this._containsCursor(evt)){return false;}var ltr=this.isLeftToRight();var i=0;for(i=0;i<this._bounds.length;i++){var _20=this._bounds[i];if(ltr){if(val<_20){break;}}else{if(val>_20){break;}}}this._showIndicatorAt(i);return true;},_showIndicatorAt:function(idx){var _21=this.getChildren();var btn=null;if(_21.length<=idx){btn=_21[idx-1];}else{btn=_21[idx];}var loc=null;if(btn){loc=this._getOffsetPosition(btn.domNode,this.tablistWrapper);loc.t-=6;loc.l-=8;if(this.isLeftToRight()){if(_21.length<=idx){loc.l+=_5.marginBox(btn.domNode).w;}}else{if(_21.length>idx){loc.l+=_5.marginBox(btn.domNode).w;}var r=_5.marginBox(this.tablistWrapper).w-loc.l-16;_5.style(this._indicator,"right",r+"px");}_5.marginBox(this._indicator,loc);_5.style(this._indicator,"display","block");}else{this._mock=this._mock||new _f();var _22=_b.byId(this.containerId);_22.addChild(this._mock);}this._insertLoc=idx;},_hideIndicator:function(){_5.style(this._indicator,"display","none");},_computeBounds:function(){this._bounds=[];var _23=this.getChildren();var c=0;for(var i=0;i<_23.length;i++){var tab=_23[i];var _24=tab.domNode.offsetLeft+_5.marginBox(tab.domNode).w/2;this._bounds.push(_24);}},_getOffsetPosition:function(_25,_26){var x=0;var y=0;var n=_25;while(n!=_26){x+=n.offsetLeft;y+=n.offsetTop;n=n.offsetParent;}return {l:x,t:y};}});var _27=_1("idx.layout.MoveableTabButton",[_d.TabButton],{delay:10,page:null,_moving:false,tabTopicId:"",postCreate:function(){this.inherited(arguments);this.connect(this.focusNode,_a.press,"_onTabMouseDown");},startup:function(){this.inherited(arguments);this._controller=_b.getEnclosingWidget(this.domNode.parentNode);},_onTabMouseDown:function(evt){this._makeSelectable(false);this._startLoc={x:evt.clientX,y:evt.clientY};this._moveConnects=[this.connect(_4.body(),_a.move,"_onTabMouseMove"),this.connect(_4.body(),_a.release,"_onTabMouseUp")];},_onTabMouseUp:function(evt){_3.forEach(this._moveConnects,function(c){this.disconnect(c);},this);if(this._moving){this._moving=false;var msg=[{target:this,content:this.page,event:evt,start:this._startLoc}];_7.publish(this.tabTopicId+"/idx/tab/move/end",msg);this._startLoc=null;}this._makeSelectable(true);},_makeSelectable:function(_28){if(dojo.isIE){if(_28){_4.body().onselectstart=this._selectHandle;}else{this._selectHandle=_4.body().onselectstart;_4.body().onselectstart=function(){return false;};}}else{_5.setSelectable(_4.body(),_28);}},_onTabMouseMove:function(evt){if(!this._startLoc){return;}var _29={x:evt.clientX,y:evt.clientY};if(this._distanceBetween(this._startLoc,_29)>this.delay){var msg=[{target:this,content:this.page,event:evt,start:this._startLoc}];var _2a="/idx/tab/move";if(!this._moving){_7.publish(this.tabTopicId+"/idx/tab/move/start",msg);this._moving=true;}else{_7.publish(this.tabTopicId+_2a,msg);}_6.stop(evt);}},_distanceBetween:function(a,b){var _2b=a.x-b.x;var _2c=a.y-b.y;var _2d=Math.sqrt(_2b*_2b+_2c*_2c);return _2d;},_setStateClass:function(){if(this._controller&&this._controller._movingTab){return;}this.inherited(arguments);},focus:function(){if(this.focusNode){this.inherited(arguments);}}});_10.MoveableTabController=_11;_10.MoveableTabButton=_27;return _10;});