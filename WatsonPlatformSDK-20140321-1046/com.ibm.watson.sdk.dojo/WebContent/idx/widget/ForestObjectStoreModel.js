//>>built
define("idx/widget/ForestObjectStoreModel",["dojo/_base/declare","dojo/_base/lang","dojo/_base/kernel","dojo/when","dojo/string","dijit/Tree","dijit/tree/ObjectStoreModel","../string","../util"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){return _1("idx.widget.ForestObjectStoreModel",[_7],{rootId:"|_-_-$root$-_-_|",rootLabel:"ROOT",query:null,constructor:function(_a){this.root={};var _b=(_a.store&&_a.store.idProperty)?_a.store.idProperty:"id";var _c=(_a.labelAttr)?_a.labelAttr:this.labelAttr;this.root[_b]=this.rootId;this.root["root"]=true;this.root[_c]=this.rootLabel;},getChildren:function(_d,_e,_f){if(_d===this.root){var id=this.rootId;if(this.childrenCache[id]){_4(this.childrenCache[id],_e,_f);return;}var res=this.childrenCache[id]=this.store.query(this.query);_4(res,_e,_f);if(res.observe){res.observe(_2.hitch(this,function(obj,_10,_11){this.onChange(obj);if(_10!=_11){_4(res,_2.hitch(this,"onChildrenChange",_d));}}),true);}}else{return this.inherited(arguments);}},fetchItemByIdentity:function(_12){if(_12.identity==this.rootId){var _13=_12.scope||_3.global;if(_12.onItem){_12.onItem.call(_13,this.root);}}else{this.store.get(_12.identity).then(_2.hitch(_12.scope,_12.onItem),_2.hitch(_12.scope,_12.onError));}},getIdentity:function(_14){return (_14===this.root)?this.rootId:this.inherited(arguments);},getLabel:function(_15){return (_15===this.root)?this.rootLabel:this.inherited(arguments);},newItem:function(_16,_17,_18,_19){if(_17===this.root){this.onNewRootItem(_16);var res=this.store.put(_16);return res;}else{return this.inherited(arguments);}},onNewRootItem:function(){},pasteItem:function(_1a,_1b,_1c,_1d,_1e,_1f){if(_1b===this.root){if(!_1d){this.onLeaveRoot(_1a);}}if(_1c===this.root){this.onAddToRoot(_1a);}return this.inherited(arguments,[_1a,_1b===this.root?null:_1b,_1c===this.root?null:_1c,_1d,_1e,_1f]);},onAddToRoot:function(_20){},onLeaveRoot:function(_21){},_requeryTop:function(){var id=this.rootId;var _22=this.childrenCache[id];if(!_22){_22=[];}_4(_22,_2.hitch(this,function(){var _23=this.store.query(this.query);_4(_23,_2.hitch(this,function(){this.childrenCache[id]=_23;if(_22.length!=_23.length||array.some(_22,function(_24,idx){return _23[idx]!=_24;})){this.onChildrenChange(this.root,_23);}}));}));}});});